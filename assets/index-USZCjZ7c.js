import{a as h,g as D,r as b,j as e,p as P,h as j,C as k,u as L,G as T,b as q,c as K,T as V,H as _}from"./index-DT_KQEYq.js";import{S as H}from"./formData-C8nk42AS.js";import{u as $,G as B,S as O,a as M,b as W}from"./useGatewayInfo-B1ikxDbW.js";import{S as C}from"./observers_bg-CMjqv-62.js";import{S as Q}from"./observers_connect_icon-Cc0GemO2.js";import{S as U}from"./pink_arrow-dCGIyjz2.js";import{A}from"./AddressCell-D_f8F7jC.js";import{C as J}from"./ColumnSelector-BmbWJT6C.js";import{D as X}from"./Dropdown-DDaUOJ8r.js";import{T as Y,c as Z}from"./index-tbIpH_Tt.js";import"./validation-DxHxJWOA.js";import"./chevron-down-CWFu1ckq.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="ca7ae15c-32b7-42e0-bdd4-bbf557978388",s._sentryDebugIdIdentifier="sentry-dbid-ca7ae15c-32b7-42e0-bdd4-bbf557978388")}catch{}})();const R=s=>{const a=h(d=>d.arIOReadSDK);return D({queryKey:["observations",a,(s==null?void 0:s.epochIndex)||-1],queryFn:()=>{if(a&&s)return a.getObservations(s);throw new Error("arIOReadSDK or currentEpoch not available")},enabled:!!a&&!!s})},E=s=>{const a=h(d=>d.arIOReadSDK);return D({queryKey:["prescribedObservers",a,(s==null?void 0:s.epochIndex)||-1],queryFn:()=>{if(a&&s)return a.getPrescribedObservers(s);throw new Error("arIOReadSDK or epoch not available")},enabled:!!a&&(s==null?void 0:s.epochIndex)!==void 0})},g=({label:s,value:a})=>e.jsxs("div",{className:"inline-flex h-[2.375rem] flex-col items-start justify-start gap-1 border-r px-12 text-left dark:border-transparent-100-8",children:[e.jsx("div",{className:"pt-1 text-xs leading-none text-low",children:s}),e.jsx("div",{className:"text-nowrap text-xs text-mid",children:a})]}),ee=()=>{const s=h(r=>r.walletAddress),a=h(r=>r.currentEpoch),[l,d]=b.useState(!1),[v,x]=b.useState(!1),{data:u}=E(a),{data:i}=R(a),{gateway:m,gatewayStatus:y}=$(),t=u==null?void 0:u.find(r=>r.gatewayAddress==(s==null?void 0:s.toString())),w=t!=null?i!=null&&i.reports[(s==null?void 0:s.toString())||""]?"Prescribed - Report Submitted":"Prescribed - Report Pending":"Not prescribed for this epoch",f=t?i!=null&&i.reports[t.gatewayAddress]?Object.values(i.failureSummaries).reduce((r,o)=>r+(o.includes(t.gatewayAddress)?1:0),0):"Pending":"N/A";return e.jsxs("div",{children:[s?y==B.NOT_FOUND?e.jsx("div",{children:e.jsxs("button",{className:"group relative h-[7.5rem] w-full overflow-hidden rounded-xl bg-grey-800",onClick:()=>{x(!0)},children:[e.jsx("div",{className:`invisible size-full rounded-xl
       bg-gradient-to-r from-gradient-primary-start to-gradient-primary-end p-px group-hover:visible`,children:e.jsx("div",{className:"size-full overflow-hidden rounded-xl bg-grey-800",children:e.jsx(O,{className:"relative -top-px left-[calc(4rem-1px)] z-0"})})}),e.jsx(O,{className:"visible absolute left-16 top-0 z-0 group-hover:invisible"}),e.jsxs("div",{className:"absolute top-0 z-10 flex size-full flex-col items-center justify-center bg-transparent py-6 align-middle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-gradient",children:"Configure your gateway"})," ",e.jsx(U,{className:"size-3"})]}),e.jsx("div",{className:"pt-2 text-sm text-low",children:"Configure a gateway to become an observer."})]})]})}):m?e.jsx("div",{className:"relative min-h-fit w-full overflow-hidden rounded-xl border border-grey-800 lg:h-[7.5rem]",children:e.jsxs("div",{className:"top-0 z-10 flex size-full flex-col bg-transparent py-6 align-middle lg:absolute",children:[e.jsxs("div",{className:"flex items-center gap-3 pl-6",children:[e.jsx(H,{className:"block h-3 w-4 group-hover:hidden"}),e.jsx(M,{className:"hidden h-3 w-4 group-hover:block"}),e.jsx("div",{className:"group-hover:text-gradient text-sm text-high",children:"My Gateway Observer Status"})]}),e.jsxs("div",{className:"relative mt-3 flex flex-col pl-1.5 lg:flex-row",children:[e.jsx(g,{label:"Observer Address",value:P(m.observerAddress)}),e.jsx(g,{label:"Status",value:w}),t&&e.jsxs(e.Fragment,{children:[e.jsx(g,{label:"Observation Chance",value:t?j(t.normalizedCompositeWeight):"N/A"}),e.jsx(g,{label:"Observer Performance",value:t?j(t.observerPerformanceRatio):"N/A"}),e.jsx(g,{label:"Failed Gateways",value:f.toString()})]})]})]})}):e.jsx("div",{className:"relative h-[7.5rem] w-full justify-center overflow-hidden rounded-xl bg-grey-800 ",children:e.jsx("div",{className:"h-full content-center text-center text-sm text-low",children:"Loading gateway information..."})}):e.jsx("div",{children:e.jsxs("button",{className:"group relative h-[7.5rem] w-full overflow-hidden rounded-xl bg-grey-800",onClick:()=>{s?x(!0):d(!0)},children:[e.jsx("div",{className:`invisible size-full rounded-xl
       bg-gradient-to-r from-gradient-primary-start to-gradient-primary-end p-px group-hover:visible`,children:e.jsx("div",{className:"size-full overflow-hidden rounded-xl bg-grey-800",children:e.jsx(C,{className:"relative left-[calc(4rem-1px)]  top-[calc(2rem-1px)] z-0 opacity-10"})})}),e.jsx(C,{className:"visible absolute left-16 top-8 z-0 opacity-10  group-hover:invisible"}),e.jsxs("div",{className:"absolute top-0 z-10 flex size-full flex-col items-center justify-center bg-transparent py-6 align-middle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"size-4"}),e.jsx("div",{className:"text-gradient",children:"Connect your wallet"})," "]}),e.jsx("div",{className:"pt-2 text-sm text-low",children:"Login to view your observer status."})]})]})}),l&&e.jsx(k,{onClose:()=>d(!1)}),v&&e.jsx(W,{onClose:()=>x(!1)})]})},c=Z(),se=()=>{const s=L(),{data:a}=T(),[l,d]=b.useState(0),v=a==null?void 0:a[l],{isLoading:x,data:u}=E(v),{isLoading:i,data:m}=R(v),{isLoading:y,data:t}=q(),[N,w]=b.useState([]);b.useEffect(()=>{if(!u||!t||!m)return;const r=u.reduce((o,n)=>{const p=t[n.gatewayAddress],S=m.reports[n.observerAddress],G=S?"Submitted":l==0?"Pending":"Did not report",I=S?Object.values(m.failureSummaries).reduce((F,z)=>F+(z.includes(n.observerAddress)?1:0),0):void 0;return[...o,{label:p.settings.label,domain:p.settings.fqdn,gatewayAddress:n.gatewayAddress,observerAddress:n.observerAddress,ncw:n.normalizedCompositeWeight,observedEpochs:p.stats.observedEpochCount+1,prescribedEpochs:p.stats.prescribedEpochCount+1,successRatio:n.observerPerformanceRatio||n.observerRewardRatioWeight,reportStatus:G,failedGateways:I}]},[]);w(r)},[u,t,m,l]);const f=[c.accessor("label",{id:"label",header:"Label",sortDescFirst:!1}),c.accessor("domain",{id:"domain",header:"Domain",sortDescFirst:!1,cell:({row:r})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://${r.getValue("domain")}`,target:"_blank",rel:"noreferrer",onClick:o=>{o.stopPropagation()},className:"text-gradient",children:r.getValue("domain")}),e.jsx(K,{textToCopy:r.getValue("domain")})]})}),c.accessor("gatewayAddress",{id:"gatewayAddress",header:"Gateway Address",sortDescFirst:!1,cell:({row:r})=>e.jsx(A,{address:r.getValue("gatewayAddress")})}),c.accessor("observerAddress",{id:"observerAddress",header:"Observer Address",sortDescFirst:!1,cell:({row:r})=>e.jsx(A,{address:r.getValue("observerAddress")})}),c.accessor("ncw",{id:"ncw",header:"Observation Chance",sortDescFirst:!0,cell:({row:r})=>j(r.original.ncw)}),c.accessor("successRatio",{id:"successRatio",header:"Observer Performance",sortDescFirst:!0,cell:({row:r})=>e.jsx(V,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["Observed Epochs: ",r.original.observedEpochs]}),e.jsxs("div",{children:["Prescribed Epochs: ",r.original.prescribedEpochs]})]}),children:`${(r.original.successRatio*100).toFixed(2)}%`})}),c.accessor("reportStatus",{id:"reportStatus",header:l==0?"Current Report Status":"Report Status",sortDescFirst:!0}),c.accessor("failedGateways",{id:"failedGateways",header:"Failed Gateways",sortDescFirst:!0,cell:({row:r})=>r.original.failedGateways||(l==0?"Pending":"N/A")})];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex w-full items-center rounded-t-xl border border-grey-600 bg-containerL3 pl-6 pr-[0.8125rem] text-sm ",children:[e.jsx("div",{className:"grow text-mid",children:"Observers"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{options:(a==null?void 0:a.map((r,o)=>({label:o==0?"Current Epoch":`Epoch ${r==null?void 0:r.epochIndex}`,value:o.toString()})))||[],onChange:r=>{d(Number(r.target.value))},value:l.toString()}),e.jsx(J,{tableId:"observers",columns:f})]})]}),e.jsx(Y,{columns:f,data:N,isLoading:x||y||i,noDataFoundText:"No prescribed observers found.",defaultSortingState:{id:"ncw",desc:!0},onRowClick:r=>{s(`/gateways/${r.gatewayAddress}`)},tableId:"observers"})]})},ge=()=>e.jsxs("div",{className:"flex h-full max-w-full flex-col",children:[e.jsx("div",{className:"mb-6 shrink-0",children:e.jsx(_,{})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("div",{className:"mb-6 flex flex-col gap-6 pt-0",children:[e.jsx(ee,{}),e.jsx(se,{})]})})})]});export{ge as default};
//# sourceMappingURL=index-USZCjZ7c.js.map
