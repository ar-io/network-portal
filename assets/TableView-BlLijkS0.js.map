{"version":3,"file":"TableView-BlLijkS0.js","sources":["../../src/components/TableView.tsx"],"sourcesContent":["import { useColumnPreferences } from '@src/store/columnPreferences';\nimport {\n  ColumnDef,\n  ColumnSort,\n  SortingState,\n  VisibilityState,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  useReactTable,\n} from '@tanstack/react-table';\nimport { useEffect, useState } from 'react';\nimport TableSkeletonRow from './TableSkeletonRow';\nimport { SortAsc, SortDesc } from './icons';\n\nconst TableView = <T, S>({\n  columns,\n  data,\n  defaultSortingState,\n  isLoading,\n  isError = false,\n  noDataFoundText = 'No data found.',\n  errorText = 'Something went wrong. Please try again.',\n  onRowClick,\n  shortTable = false,\n  tableId,\n  loadingRows = 5,\n}: {\n  columns: ColumnDef<T, S>[];\n  data: T[];\n  defaultSortingState: ColumnSort;\n  isLoading: boolean;\n  isError?: boolean;\n  noDataFoundText?: string;\n  errorText?: string;\n  onRowClick?: (row: T) => void;\n  shortTable?: boolean;\n  tableId?: string;\n  loadingRows?: number;\n}) => {\n  const [sorting, setSorting] = useState<SortingState>([defaultSortingState]);\n  const [columnVisibility, setColumnVisibility] = useState<VisibilityState>({});\n\n  const { getTableColumnVisibility } = useColumnPreferences();\n\n  // Initialize and subscribe to column visibility changes from store\n  useEffect(() => {\n    if (!tableId) return;\n\n    const updateColumnVisibility = () => {\n      const storedVisibility = getTableColumnVisibility(tableId);\n      // Convert stored visibility to react-table format\n      const reactTableVisibility: VisibilityState = {};\n      columns.forEach((column) => {\n        if (column.id) {\n          // Default to visible (true) if not explicitly set to false\n          reactTableVisibility[column.id] =\n            storedVisibility[column.id] !== false;\n        }\n      });\n      setColumnVisibility(reactTableVisibility);\n    };\n\n    // Initial load\n    updateColumnVisibility();\n\n    // Subscribe to changes for this specific table\n    const unsubscribe = useColumnPreferences.subscribe(\n      (state) => state.preferences[tableId],\n      () => updateColumnVisibility(),\n      { equalityFn: (a, b) => JSON.stringify(a) === JSON.stringify(b) },\n    );\n\n    return unsubscribe;\n  }, [tableId, columns, getTableColumnVisibility]);\n\n  const table = useReactTable({\n    columns,\n    data,\n    getCoreRowModel: getCoreRowModel<T>(),\n    getSortedRowModel: getSortedRowModel(),\n    state: {\n      sorting,\n      ...(tableId ? { columnVisibility } : {}),\n    },\n    onSortingChange: setSorting,\n    onColumnVisibilityChange: setColumnVisibility,\n  });\n\n  const maxHeightRemClass = shortTable ? `max-h-[16rem]` : undefined;\n\n  return (\n    <div\n      className={`overflow-x-auto scrollbar scrollbar-thin ${maxHeightRemClass}`}\n    >\n      <table className=\"w-full table-auto border-x border-b border-grey-500\">\n        <thead className=\"sticky top-0 z-10 bg-containerL0 text-xs text-low\">\n          {table.getHeaderGroups().map((headerGroup) => (\n            <tr key={headerGroup.id}>\n              {headerGroup.headers.map((header) => {\n                const sortState = header.column.getIsSorted();\n                return (\n                  <th key={header.id} className=\"py-2 pl-6\">\n                    <button\n                      className=\"flex items-center gap-1 text-left\"\n                      onClick={() => {\n                        setSorting([\n                          {\n                            id: header.column.id,\n                            desc: sortState\n                              ? sortState === 'desc'\n                                ? false\n                                : true\n                              : (header.column.columnDef.sortDescFirst ?? true),\n                          },\n                        ]);\n                      }}\n                    >\n                      {flexRender(\n                        header.column.columnDef.header,\n                        header.getContext(),\n                      )}\n                      {sortState ? (\n                        sortState === 'desc' ? (\n                          <SortDesc />\n                        ) : (\n                          <SortAsc />\n                        )\n                      ) : (\n                        <div className=\"w-4\" />\n                      )}\n                    </button>\n                  </th>\n                );\n              })}\n            </tr>\n          ))}\n        </thead>\n        <tbody className=\"overflow-y-auto text-sm\">\n          {isLoading\n            ? // Show skeleton rows when loading\n              Array.from({ length: loadingRows }, (_, index) => (\n                <TableSkeletonRow\n                  key={index}\n                  columns={\n                    table.getAllColumns().filter((col) => col.getIsVisible())\n                      .length\n                  }\n                />\n              ))\n            : // Show actual data rows when not loading\n              table\n                .getRowModel()\n                .rows.map((row) => {\n                  return (\n                    <tr\n                      key={row.id}\n                      className={`border-t border-grey-500 text-low *:py-4 *:pl-6 transition-all duration-200 ${onRowClick ? 'cursor-pointer hover:bg-gradient-to-r hover:from-transparent hover:via-[#E19EE505] hover:to-transparent' : ''}`}\n                      onClick={\n                        onRowClick ? () => onRowClick(row.original) : undefined\n                      }\n                    >\n                      {row.getVisibleCells().map((cell) => (\n                        <td key={cell.id}>\n                          {flexRender(\n                            cell.column.columnDef.cell,\n                            cell.getContext(),\n                          )}\n                        </td>\n                      ))}\n                    </tr>\n                  );\n                })}\n        </tbody>\n      </table>\n      {!isLoading && !isError && table.getRowCount() === 0 && (\n        <div className=\"flex h-[6.25rem] items-center justify-center border-x border-b border-grey-500 text-low\">\n          {noDataFoundText}\n        </div>\n      )}\n      {!isLoading && isError && (\n        <div className=\"flex h-[6.25rem] items-center justify-center border-x border-b border-grey-500 text-low\">\n          {errorText}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default TableView;\n"],"names":["TableView","columns","data","defaultSortingState","isLoading","isError","noDataFoundText","errorText","onRowClick","shortTable","tableId","loadingRows","sorting","setSorting","reactExports","columnVisibility","setColumnVisibility","getTableColumnVisibility","useColumnPreferences","updateColumnVisibility","storedVisibility","reactTableVisibility","column","state","a","b","table","useReactTable","getCoreRowModel","getSortedRowModel","maxHeightRemClass","jsxRuntimeExports","headerGroup","header","sortState","flexRender","SvgSortDesc","SvgSortAsc","_","index","TableSkeletonRow","col","row","cell"],"mappings":"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"}