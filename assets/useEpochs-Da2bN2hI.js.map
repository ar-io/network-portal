{"version":3,"file":"useEpochs-Da2bN2hI.js","sources":["../../src/hooks/useEpochs.ts"],"sourcesContent":["import { useGlobalState } from '@src/store';\nimport { getEpoch } from '@src/store/db';\nimport { showErrorToast } from '@src/utils/toast';\nimport { useQuery } from '@tanstack/react-query';\n\n// TODO: this could be a parameter provided by the user now\nconst HISTORICAL_EPOCHS_TO_FETCH = 13;\n\n/** Returns last EPOCHS_TO_FETCH epochs */\nconst useEpochs = () => {\n  const arIOReadSDK = useGlobalState((state) => state.arIOReadSDK);\n  const startEpoch = useGlobalState((state) => state.currentEpoch);\n  const networkPortalDB = useGlobalState((state) => state.networkPortalDB);\n\n  const queryResults = useQuery({\n    queryKey: ['epochs', arIOReadSDK, startEpoch],\n    queryFn: async () => {\n      if (!arIOReadSDK || startEpoch === undefined) {\n        throw new Error('arIOReadSDK or startEpoch not available');\n      }\n\n      const additionalEpochs = await Promise.all(\n        Array.from(\n          { length: HISTORICAL_EPOCHS_TO_FETCH },\n          (_, index) => startEpoch.epochIndex - index - 1,\n        ).map((epochIndex) =>\n          getEpoch(networkPortalDB, arIOReadSDK, epochIndex)\n            .then((epoch) => {\n              return epoch;\n            })\n            .catch(() => {\n              showErrorToast(\n                `Unable to retrieve epoch data for epoch ${epochIndex}.`,\n              );\n              return undefined;\n            }),\n        ),\n      );\n\n      return [\n        startEpoch,\n        ...additionalEpochs.filter((e: any) => e !== undefined),\n      ];\n    },\n    enabled: !!arIOReadSDK && startEpoch !== undefined,\n    staleTime: 60 * 60 * 1000, // 1 hour\n  });\n\n  return queryResults;\n};\n\nexport default useEpochs;\n"],"names":["HISTORICAL_EPOCHS_TO_FETCH","useEpochs","arIOReadSDK","useGlobalState","state","startEpoch","networkPortalDB","useQuery","additionalEpochs","_","index","epochIndex","getEpoch","epoch","showErrorToast","e"],"mappings":"qXAMA,MAAAA,EAAA,GAGAC,EAAA,IAAA,CACA,MAAAC,EAAAC,EAAAC,GAAAA,EAAA,WAAA,EACAC,EAAAF,EAAAC,GAAAA,EAAA,YAAA,EACAE,EAAAH,EAAAC,GAAAA,EAAA,eAAA,EAoCA,OAlCAG,EAAA,CAAA,SAAA,CAAA,SAAAL,EAAAG,CAAA,EACA,QAAA,SAAA,CAEA,GAAA,CAAAH,GAAAG,IAAA,OACA,MAAA,IAAA,MAAA,yCAAA,EAGA,MAAAG,EAAA,MAAA,QAAA,IAAA,MAAA,KACA,CAAA,OAAAR,CAAA,EACA,CAAAS,EAAAC,IAAAL,EAAA,WAAAK,EAAA,CACA,EAAA,IACAC,GAAAC,EAAAN,EAAAJ,EAAAS,CAAA,EAAA,KAAAE,GAGAA,CAAA,EAAA,MAAA,IAAA,CAGAC,EAAA,2CAAAH,CAAA,GACA,CAEA,CAAA,CACA,CACA,EAGA,MAAA,CAAAN,EACA,GAAAG,EAAA,OAAAO,GAAAA,IAAA,MAAA,CACA,CACA,EACA,QAAA,CAAA,CAAAb,GAAAG,IAAA,OACA,UAAA,GAAA,GAAA,GACA,CAAA,CAIA"}