import{a as w,i as P,r as i,j as e,S as B,x as U,l as D,C as Q,c as J,u as X,t as Y,d as Z,T as ee,e as F,H as se}from"./index-DQHvdTxE.js";import{S as re}from"./gateway-B3zteQzV.js";import{u as te,G as ae,S as G,a as oe}from"./useGatewayInfo-Buw5l1xe.js";import{S as T}from"./observers_bg-xlnOcpCq.js";import{S as le}from"./observers_connect_icon-CTU2mtDL.js";import{A as z}from"./AddressCell-B1rVsCfI.js";import{C as ie}from"./ColumnSelector-BE6fw_Y1.js";import{D as ne}from"./Dropdown-DN-2ntCb.js";import{T as de}from"./TableView-BlLijkS0.js";import{u as ce}from"./useEpochs-Da2bN2hI.js";import{S as ue}from"./search-B5ZvmDow.js";import{c as me}from"./TableSkeletonRow-zrttk92L.js";import"./chevron-down-Df4H2pU7.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="90c8ce6a-64ac-45f8-dda5-c7f1f60d191f",s._sentryDebugIdIdentifier="sentry-dbid-90c8ce6a-64ac-45f8-dda5-c7f1f60d191f")}catch{}})();const L=s=>{const t=w(d=>d.arIOReadSDK);return P({queryKey:["observations",t,(s==null?void 0:s.epochIndex)||-1],queryFn:()=>{if(t&&s)return t.getObservations(s);throw new Error("arIOReadSDK or currentEpoch not available")},enabled:!!t&&!!s,staleTime:60*60*1e3})},k=s=>{const t=w(d=>d.arIOReadSDK);return P({queryKey:["prescribedObservers",t,(s==null?void 0:s.epochIndex)||-1],queryFn:()=>{if(t&&s)return t.getPrescribedObservers(s);throw new Error("arIOReadSDK or epoch not available")},enabled:!!t&&(s==null?void 0:s.epochIndex)!==void 0,staleTime:60*60*1e3})},v=({label:s,value:t})=>e.jsxs("div",{className:"inline-flex h-[2.375rem] flex-col items-start justify-start gap-1 border-r px-12 text-left dark:border-transparent-100-8",children:[e.jsx("div",{className:"pt-1 text-xs leading-none text-low",children:s}),e.jsx("div",{className:"text-nowrap text-xs text-mid",children:t})]}),xe=()=>{const s=w(a=>a.walletAddress),t=w(a=>a.currentEpoch),[o,d]=i.useState(!1),[g,f]=i.useState(!1),{data:c}=k(t),{data:n}=L(t),{gateway:b,gatewayStatus:j}=te(),l=c==null?void 0:c.find(a=>a.gatewayAddress===(s==null?void 0:s.toString())),S=l!==void 0?n!=null&&n.reports[(s==null?void 0:s.toString())||""]?"Prescribed - Report Submitted":"Prescribed - Report Pending":"Not prescribed for this epoch",N=l?n!=null&&n.reports[l.gatewayAddress]?Object.values(n.failureSummaries).reduce((a,O)=>a+(O.includes(l.gatewayAddress)?1:0),0):"Pending":"N/A";return e.jsxs(e.Fragment,{children:[s?j===ae.NOT_FOUND?e.jsxs("button",{className:"group relative h-[7.5rem] w-full overflow-hidden rounded-xl bg-grey-800",onClick:()=>{f(!0)},children:[e.jsx("div",{className:`invisible size-full rounded-xl
       bg-gradient-to-r from-gradient-primary-start to-gradient-primary-end p-px group-hover:visible`,children:e.jsx("div",{className:"size-full overflow-hidden rounded-xl bg-grey-800",children:e.jsx(G,{className:"relative -top-px left-[calc(4rem-1px)] z-0"})})}),e.jsx(G,{className:"visible absolute left-16 top-0 z-0 group-hover:invisible"}),e.jsxs("div",{className:"absolute top-0 z-10 flex size-full flex-col items-center justify-center bg-transparent py-6 align-middle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-gradient",children:"Configure your gateway"})," ",e.jsx(B,{className:"size-3"})]}),e.jsx("div",{className:"pt-2 text-sm text-low",children:"Configure a gateway to become an observer."})]})]}):b?e.jsx("div",{className:"relative min-h-fit w-full overflow-hidden rounded-xl border border-grey-800 lg:h-[7.5rem]",children:e.jsxs("div",{className:"top-0 z-10 flex size-full flex-col bg-transparent py-6 align-middle lg:absolute",children:[e.jsxs("div",{className:"flex items-center gap-3 pl-6",children:[e.jsx(re,{className:"block h-3 w-4 group-hover:hidden"}),e.jsx(oe,{className:"hidden h-3 w-4 group-hover:block"}),e.jsx("div",{className:"group-hover:text-gradient text-sm text-high",children:"My Gateway Observer Status"})]}),e.jsxs("div",{className:"relative mt-3 flex flex-col pl-1.5 lg:flex-row",children:[e.jsx(v,{label:"Observer Address",value:U(b.observerAddress)}),e.jsx(v,{label:"Status",value:S}),l&&e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Observation Chance",value:l?D(l.normalizedCompositeWeight):"N/A"}),e.jsx(v,{label:"Observer Performance",value:l?D(l.observerPerformanceRatio):"N/A"}),e.jsx(v,{label:"Failed Gateways",value:N.toString()})]})]})]})}):e.jsx("div",{className:"relative h-[7.5rem] w-full justify-center overflow-hidden rounded-xl bg-grey-800 ",children:e.jsx("div",{className:"h-full content-center text-center text-sm text-low",children:"Loading gateway information..."})}):e.jsxs("button",{className:"group relative h-[7.5rem] w-full overflow-hidden rounded-xl bg-grey-800",onClick:()=>{s?f(!0):d(!0)},children:[e.jsx("div",{className:`invisible size-full rounded-xl
       bg-gradient-to-r from-gradient-primary-start to-gradient-primary-end p-px group-hover:visible`,children:e.jsx("div",{className:"size-full overflow-hidden rounded-xl bg-grey-800",children:e.jsx(T,{className:"relative left-[calc(4rem-1px)]  top-[calc(2rem-1px)] z-0 opacity-10"})})}),e.jsx(T,{className:"visible absolute left-16 top-8 z-0 opacity-10  group-hover:invisible"}),e.jsxs("div",{className:"absolute top-0 z-10 flex size-full flex-col items-center justify-center bg-transparent py-6 align-middle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"size-4"}),e.jsx("div",{className:"text-gradient",children:"Connect your wallet"})," "]}),e.jsx("div",{className:"pt-2 text-sm text-low",children:"Login to view your observer status."})]})]}),o&&e.jsx(Q,{onClose:()=>d(!1)}),g&&e.jsx(J,{onClose:()=>f(!1)})]})},x=me(),ge=()=>{const s=X(),{data:t}=ce(),[o,d]=i.useState(0),[g,f]=i.useState(""),[c,n]=i.useState("");i.useEffect(()=>{const r=setTimeout(()=>{n(g.trim())},300);return()=>clearTimeout(r)},[g]);const b=t==null?void 0:t[o],{isLoading:j,isError:l,data:p}=k(b),{isLoading:S,isError:N,data:a}=L(b),{isLoading:O,isError:q,data:C}=Y(),[h,K]=i.useState([]),[$,V]=i.useState(!0);i.useEffect(()=>{if(!p||!C||!a)return;const r=Object.values(a.failureSummaries),u=p.map(m=>{const y=C[m.gatewayAddress],I=a.reports[m.observerAddress],_=I?"Submitted":o===0?"Pending":"Did not report",H=I?r.reduce((M,W)=>M+(W.includes(m.observerAddress)?1:0),0):void 0;return{label:y.settings.label,domain:y.settings.fqdn,gatewayAddress:m.gatewayAddress,observerAddress:m.observerAddress,ncw:m.normalizedCompositeWeight,observedEpochs:y.stats.observedEpochCount+1,prescribedEpochs:y.stats.prescribedEpochCount+1,successRatio:m.observerPerformanceRatio||m.observerRewardRatioWeight,reportStatus:_,failedGateways:H}});K(u),V(!1)},[p,C,a,o]);const E=i.useMemo(()=>{if(!c)return h;const r=c.toLowerCase();return h.filter(u=>u.domain.toLowerCase().includes(r))},[h,c]),A=[x.accessor("label",{id:"label",header:"Label",sortDescFirst:!1}),x.accessor("domain",{id:"domain",header:"Domain",sortDescFirst:!1,cell:({row:r})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://${r.getValue("domain")}`,target:"_blank",rel:"noreferrer",onClick:u=>{u.stopPropagation()},className:"text-gradient",children:r.getValue("domain")}),e.jsx(Z,{textToCopy:r.getValue("domain")})]})}),x.accessor("gatewayAddress",{id:"gatewayAddress",header:"Gateway Address",sortDescFirst:!1,cell:({row:r})=>e.jsx(z,{address:r.getValue("gatewayAddress")})}),x.accessor("observerAddress",{id:"observerAddress",header:"Observer Address",sortDescFirst:!1,cell:({row:r})=>e.jsx(z,{address:r.getValue("observerAddress")})}),x.accessor("ncw",{id:"ncw",header:"Observation Chance",sortDescFirst:!0,cell:({row:r})=>D(r.original.ncw)}),x.accessor("successRatio",{id:"successRatio",header:"Observer Performance",sortDescFirst:!0,cell:({row:r})=>e.jsx(ee,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["Observed Epochs: ",r.original.observedEpochs]}),e.jsxs("div",{children:["Prescribed Epochs: ",r.original.prescribedEpochs]})]}),children:`${(r.original.successRatio*100).toFixed(2)}%`})}),x.accessor("reportStatus",{id:"reportStatus",header:o===0?"Current Report Status":"Report Status",sortDescFirst:!0}),x.accessor("failedGateways",{id:"failedGateways",header:"Failed Gateways",sortDescFirst:!0,cell:({row:r})=>r.original.failedGateways||(o===0?"Pending":"N/A")})],R=j||O||S||$;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex w-full items-center overflow-x-auto justify-between rounded-t-xl border border-grey-600 bg-containerL3 py-2 pl-6 pr-[0.8125rem] text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-mid",children:["Observers"," ",!R&&`(${F(E.length)}${c?` of ${F(h.length)}`:""})`]}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-low"}),e.jsx("input",{type:"text",placeholder:"Search domain...",value:g,onChange:r=>f(r.target.value),className:"w-[400px] rounded-md border border-grey-700 bg-grey-1000 py-1.5 pl-9 pr-3 text-sm text-mid outline-none placeholder:text-grey-400 focus:text-high"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{options:(t==null?void 0:t.map((r,u)=>({label:u===0?"Current Epoch":`Epoch ${r==null?void 0:r.epochIndex}`,value:u.toString()})))||[],onChange:r=>{d(Number(r.target.value))},value:o.toString()}),e.jsx(ie,{tableId:"observers",columns:A})]})]}),e.jsx(de,{columns:A,data:E,isLoading:R,isError:l||q||N,noDataFoundText:"No prescribed observers found.",errorText:"Unable to load observers.",loadingRows:50,defaultSortingState:{id:"ncw",desc:!0},onRowClick:r=>{s(`/gateways/${r.gatewayAddress}`)},tableId:"observers"})]})},Ee=()=>e.jsxs("div",{className:"px-4 lg:px-6 flex h-full max-w-full flex-col",children:[e.jsx("div",{className:"mb-4 shrink-0",children:e.jsx(se,{})}),e.jsx("div",{className:"flex-1 overflow-scroll scrollbar scrollbar-thin",children:e.jsxs("div",{className:"mb-6 flex flex-col gap-6 pt-0",children:[e.jsx(xe,{}),e.jsx(ge,{})]})})]});export{Ee as default};
//# sourceMappingURL=index-30J-5My-.js.map
