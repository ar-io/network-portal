{"version":3,"file":"ServerSortableTableView-BKj2xuUh.js","sources":["../../src/components/icons/caret_right.svg?react","../../src/components/ServerSortableTableView.tsx"],"sourcesContent":["import * as React from \"react\";\nconst SvgCaretRight = (props) => /* @__PURE__ */ React.createElement(\"svg\", { width: 20, height: 20, viewBox: \"0 0 20 20\", fill: \"none\", xmlns: \"http://www.w3.org/2000/svg\", ...props }, /* @__PURE__ */ React.createElement(\"g\", { id: \"CaretRight\" }, /* @__PURE__ */ React.createElement(\"path\", { id: \"Vector\", d: \"M11.0675 10.4425L4.81753 16.6925C4.70026 16.8098 4.5412 16.8757 4.37535 16.8757C4.2095 16.8757 4.05044 16.8098 3.93316 16.6925C3.81588 16.5753 3.75 16.4162 3.75 16.2503C3.75 16.0845 3.81588 15.9254 3.93316 15.8082L9.74175 10.0003L3.93316 4.19253C3.81588 4.07526 3.75 3.9162 3.75 3.75035C3.75 3.5845 3.81588 3.42544 3.93316 3.30816C4.05044 3.19088 4.2095 3.125 4.37535 3.125C4.5412 3.125 4.70026 3.19088 4.81753 3.30816L11.0675 9.55816C11.1256 9.61621 11.1717 9.68514 11.2032 9.76101C11.2347 9.83688 11.2508 9.91821 11.2508 10.0003C11.2508 10.0825 11.2347 10.1638 11.2032 10.2397C11.1717 10.3156 11.1256 10.3845 11.0675 10.4425Z\", fill: \"#8C8C8C\" })));\nexport default SvgCaretRight;\n","import { useColumnPreferences } from '@src/store/columnPreferences';\nimport {\n  ColumnDef,\n  ColumnSort,\n  SortingState,\n  VisibilityState,\n  flexRender,\n  getCoreRowModel,\n  useReactTable,\n} from '@tanstack/react-table';\nimport { useEffect, useState } from 'react';\nimport TableSkeletonRow from './TableSkeletonRow';\nimport { SortAsc, SortDesc } from './icons';\n\nconst ServerSortableTableView = <T, S>({\n  columns,\n  data,\n  defaultSortingState,\n  isLoading,\n  isFetching = false,\n  isError = false,\n  noDataFoundText = 'No data found.',\n  errorText = 'Something went wrong. Please try again.',\n  onRowClick,\n  shortTable = false,\n  tableId,\n  loadingRows = 5,\n  onSortingChange,\n  currentSorting,\n}: {\n  columns: ColumnDef<T, S>[];\n  data: T[];\n  defaultSortingState: ColumnSort;\n  isLoading: boolean;\n  isFetching?: boolean;\n  isError?: boolean;\n  noDataFoundText?: string;\n  errorText?: string;\n  onRowClick?: (row: T) => void;\n  shortTable?: boolean;\n  tableId?: string;\n  loadingRows?: number;\n  onSortingChange?: (sorting: SortingState) => void;\n  currentSorting?: SortingState;\n}) => {\n  const [sorting, setSorting] = useState<SortingState>(\n    currentSorting || [defaultSortingState],\n  );\n  const [columnVisibility, setColumnVisibility] = useState<VisibilityState>({});\n\n  const { getTableColumnVisibility } = useColumnPreferences();\n\n  // Update local sorting when currentSorting prop changes\n  useEffect(() => {\n    if (currentSorting) {\n      setSorting(currentSorting);\n    }\n  }, [currentSorting]);\n\n  // Initialize and subscribe to column visibility changes from store\n  useEffect(() => {\n    if (!tableId) return;\n\n    const updateColumnVisibility = () => {\n      const storedVisibility = getTableColumnVisibility(tableId);\n      // Convert stored visibility to react-table format\n      const reactTableVisibility: VisibilityState = {};\n      columns.forEach((column) => {\n        if (column.id) {\n          // Default to visible (true) if not explicitly set to false\n          reactTableVisibility[column.id] =\n            storedVisibility[column.id] !== false;\n        }\n      });\n      setColumnVisibility(reactTableVisibility);\n    };\n\n    // Initial load\n    updateColumnVisibility();\n\n    // Subscribe to changes for this specific table\n    const unsubscribe = useColumnPreferences.subscribe(\n      (state) => state.preferences[tableId],\n      () => updateColumnVisibility(),\n      { equalityFn: (a, b) => JSON.stringify(a) === JSON.stringify(b) },\n    );\n\n    return unsubscribe;\n  }, [tableId, columns, getTableColumnVisibility]);\n\n  const handleSortingChange = (updaterOrValue: any) => {\n    const newSorting =\n      typeof updaterOrValue === 'function'\n        ? updaterOrValue(sorting)\n        : updaterOrValue;\n    setSorting(newSorting);\n    onSortingChange?.(newSorting);\n  };\n\n  const table = useReactTable({\n    columns,\n    data,\n    getCoreRowModel: getCoreRowModel<T>(),\n    // Disable client-side sorting since we're doing server-side\n    enableSorting: false,\n    state: {\n      sorting,\n      ...(tableId ? { columnVisibility } : {}),\n    },\n    onSortingChange: handleSortingChange,\n    onColumnVisibilityChange: setColumnVisibility,\n  });\n\n  const maxHeightRemClass = shortTable ? `max-h-[16rem]` : undefined;\n\n  return (\n    <div className={`overflow-x-auto scrollbar ${maxHeightRemClass}`}>\n      <table className=\"w-full table-auto border-x border-b border-grey-500\">\n        <thead className=\"sticky top-0 z-10 bg-containerL0 text-xs text-low\">\n          {table.getHeaderGroups().map((headerGroup) => (\n            <tr key={headerGroup.id}>\n              {headerGroup.headers.map((header) => {\n                const sortState = header.column.getIsSorted();\n                const canSort = header.column.columnDef.enableSorting !== false;\n\n                return (\n                  <th key={header.id} className=\"py-2 pl-6\">\n                    {header.isPlaceholder ? null : canSort ? (\n                      <button\n                        className=\"flex items-center gap-1 text-left\"\n                        onClick={() => {\n                          const isDesc = sortState === 'desc';\n                          const isAsc = sortState === 'asc';\n                          let nextSort: 'asc' | 'desc' | false = false;\n\n                          if (!isAsc && !isDesc) {\n                            // No sort -> asc/desc based on column preference\n                            nextSort = header.column.columnDef.sortDescFirst\n                              ? 'desc'\n                              : 'asc';\n                          } else if (isAsc) {\n                            // asc -> desc\n                            nextSort = 'desc';\n                          } else if (isDesc) {\n                            // desc -> asc\n                            nextSort = 'asc';\n                          }\n\n                          if (nextSort) {\n                            handleSortingChange([\n                              {\n                                id: header.id,\n                                desc: nextSort === 'desc',\n                              },\n                            ]);\n                          }\n                        }}\n                      >\n                        {flexRender(\n                          header.column.columnDef.header,\n                          header.getContext(),\n                        )}\n                        {sortState ? (\n                          sortState === 'desc' ? (\n                            <SortDesc />\n                          ) : (\n                            <SortAsc />\n                          )\n                        ) : (\n                          <div className=\"w-4\" />\n                        )}\n                      </button>\n                    ) : (\n                      <div className=\"text-left\">\n                        {flexRender(\n                          header.column.columnDef.header,\n                          header.getContext(),\n                        )}\n                      </div>\n                    )}\n                  </th>\n                );\n              })}\n            </tr>\n          ))}\n        </thead>\n        <tbody className=\"overflow-y-auto text-sm\">\n          {isLoading || isFetching ? (\n            // Show skeleton rows when loading or fetching\n            Array.from({ length: loadingRows }, (_, index) => (\n              <TableSkeletonRow\n                key={index}\n                columns={\n                  table.getAllColumns().filter((col) => col.getIsVisible())\n                    .length\n                }\n              />\n            ))\n          ) : isError ? (\n            // Show error message\n            <tr>\n              <td\n                colSpan={columns.length}\n                className=\"p-4 text-center text-sm text-mid\"\n              >\n                {errorText}\n              </td>\n            </tr>\n          ) : data.length === 0 ? (\n            // Show no data message\n            <tr>\n              <td\n                colSpan={columns.length}\n                className=\"p-4 text-center text-sm text-mid\"\n              >\n                {noDataFoundText}\n              </td>\n            </tr>\n          ) : (\n            // Show actual data rows when not loading\n            table\n              .getRowModel()\n              .rows.map((row) => {\n                return (\n                  <tr\n                    key={row.id}\n                    className={`border-t border-grey-500 text-low *:py-4 *:pl-6 transition-all duration-200 ${onRowClick ? 'cursor-pointer hover:bg-gradient-to-r hover:from-transparent hover:via-[#E19EE505] hover:to-transparent' : ''}`}\n                    onClick={\n                      onRowClick ? () => onRowClick(row.original) : undefined\n                    }\n                  >\n                    {row.getVisibleCells().map((cell) => (\n                      <td key={cell.id}>\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext(),\n                        )}\n                      </td>\n                    ))}\n                  </tr>\n                );\n              })\n          )}\n        </tbody>\n      </table>\n    </div>\n  );\n};\n\nexport default ServerSortableTableView;\n"],"names":["SvgCaretRight","props","reactExports","ServerSortableTableView","columns","data","defaultSortingState","isLoading","isFetching","isError","noDataFoundText","errorText","onRowClick","shortTable","tableId","loadingRows","onSortingChange","currentSorting","sorting","setSorting","columnVisibility","setColumnVisibility","getTableColumnVisibility","useColumnPreferences","updateColumnVisibility","storedVisibility","reactTableVisibility","column","state","a","b","handleSortingChange","updaterOrValue","newSorting","table","useReactTable","getCoreRowModel","maxHeightRemClass","jsxRuntimeExports","headerGroup","header","sortState","canSort","isDesc","isAsc","nextSort","flexRender","SvgSortDesc","SvgSortAsc","_","index","TableSkeletonRow","col","row","cell"],"mappings":"mcACK,MAAAA,EAAAC,GAAAC,EAAA,cAAA,MAAA,CAAA,MAAA,GAAA,OAAA,GAAA,QAAA,YAAA,KAAA,OAAA,MAAA,6BAAA,GAAAD,CAAA,EAAAC,EAAA,cAAA,IAAA,CAAA,GAAA,YAAA,EAAAA,EAAA,cAAA,OAAA,CAAA,GAAA,SAAA,EAAA,snBAAA,KAAA,SAAA,CAAA,CAAA,CAAA,ECaLC,EAAA,CAAA,CAAA,QAAAC,EACA,KAAAC,EACA,oBAAAC,EACA,UAAAC,EACA,WAAAC,EAAA,GACA,QAAAC,EAAA,GACA,gBAAAC,EAAA,iBACA,UAAAC,EAAA,0CACA,WAAAC,EACA,WAAAC,EAAA,GACA,QAAAC,EACA,YAAAC,EAAA,EACA,gBAAAC,EACA,eAAAC,CAEA,IAAA,CAgBA,KAAA,CAAAC,EAAAC,CAAA,EAAAjB,EAAA,SAAAe,GAAA,CAAAX,CAAA,CACA,EAEA,CAAAc,EAAAC,CAAA,EAAAnB,EAAA,SAAA,CAAA,CAAA,EAEA,CAAA,yBAAAoB,CAAA,EAAAC,EAAA,EAGArB,EAAA,UAAA,IAAA,CACAe,GACAE,EAAAF,CAAA,CACA,EAAA,CAAAA,CAAA,CAAA,EAIAf,EAAA,UAAA,IAAA,CACA,GAAA,CAAAY,EAAA,OAEA,MAAAU,EAAA,IAAA,CACA,MAAAC,EAAAH,EAAAR,CAAA,EAEAY,EAAA,CAAA,EACAtB,EAAA,QAAAuB,GAAA,CACAA,EAAA,KAEAD,EAAAC,EAAA,EAAA,EAAAF,EAAAE,EAAA,EAAA,IAAA,GAEA,CAAA,EAEAN,EAAAK,CAAA,CAAA,EAIA,OAAAF,EAAA,EAGAD,EAAA,UAAAK,GAAAA,EAAA,YAAAd,CAAA,EACA,IAAAU,EAAA,EACA,CAAA,WAAA,CAAAK,EAAAC,IAAA,KAAA,UAAAD,CAAA,IAAA,KAAA,UAAAC,CAAA,CAAA,CACA,CAGA,EAAA,CAAAhB,EAAAV,EAAAkB,CAAA,CAAA,EAGA,MAAAS,EAAAC,GAAA,CACA,MAAAC,EAAA,OAAAD,GAAA,WAAAA,EAAAd,CAAA,EAAAc,EAIAb,EAAAc,CAAA,EACAjB,GAAA,MAAAA,EAAAiB,EAAA,EAGAC,EAAAC,EAAA,CAAA,QAAA/B,EACA,KAAAC,EACA,gBAAA+B,EAAA,EACA,cAAA,GAEA,MAAA,CACA,QAAAlB,EACA,GAAAJ,EAAA,CAAA,iBAAAM,CAAA,EAAA,CAAA,CACA,EACA,gBAAAW,EACA,yBAAAV,CACA,CAAA,EAGAgB,EAAAxB,EAAA,gBAAA,OAEA,OAAAyB,EAAA,IAAA,MAAA,CAAA,UAAA,6BAAAD,CAAA,GAAA,SAAAC,EAAA,KAAA,QAAA,CAAA,UAAA,sDAAA,SAAA,CAGAA,EAAA,IAAA,QAAA,CAAA,UAAA,oDAAA,SAAAJ,EAAA,gBAAA,EAAA,IAAAK,GAAAD,EAAA,IAAA,KAAA,CAAA,SAAAC,EAAA,QAAA,IAAAC,GAAA,CAIA,MAAAC,EAAAD,EAAA,OAAA,YAAA,EACAE,EAAAF,EAAA,OAAA,UAAA,gBAAA,GAEA,OAAAF,EAAA,IAAA,KAAA,CAAA,UAAA,YAAA,SAAAE,EAAA,cAAA,KAAAE,EAAAJ,EAAA,KAGA,SAAA,CAAA,UAAA,oCACA,QAAA,IAAA,CAEA,MAAAK,EAAAF,IAAA,OACAG,EAAAH,IAAA,MACA,IAAAI,EAAA,GAEA,CAAAD,GAAA,CAAAD,EAEAE,EAAAL,EAAA,OAAA,UAAA,cAAA,OAAA,MAEAI,EAGAC,EAAA,OAAAF,IAGAE,EAAA,OAGAA,GACAd,EAAA,CAAA,CACA,GAAAS,EAAA,GACA,KAAAK,IAAA,MACA,CACA,CAAA,CAEA,EACA,SAAA,CAEAC,EAAAN,EAAA,OAAA,UAAA,OACAA,EAAA,WAAA,CACA,EACAC,EAAAA,IAAA,OAAAH,EAAA,IAAAS,EAAA,CAAA,CAAA,EAAAT,EAAA,IAAAU,EAAA,CAAA,CAAA,EAAAV,EAAA,IAAA,MAAA,CAAA,UAAA,KAAA,CAAA,CAQA,CAAA,CAAA,EAAAA,EAAA,IAAA,MAAA,CAAA,UAAA,YAAA,SAAAQ,EAKAN,EAAA,OAAA,UAAA,OACAA,EAAA,WAAA,CACA,CAAA,CAAA,CAAA,EAAAA,EAAA,EAAA,CAIA,CAAA,CAAA,EAAAD,EAAA,EAAA,CAAA,CAAA,CAAA,EAKAD,EAAA,IAAA,QAAA,CAAA,UAAA,0BAAA,SAAA/B,GAAAC,EAEA,MAAA,KAAA,CAAA,OAAAO,CAAA,EAAA,CAAAkC,EAAAC,IAAAZ,EAAA,IAGAa,EAAA,CAAA,QAAAjB,EAAA,cAAA,EAAA,OAAAkB,GAAAA,EAAA,aAAA,CAAA,EAAA,MAIA,EAAAF,CAHA,CAAA,EAMAzC,EACA6B,EAAA,IAAA,KAAA,CAAA,SAAAA,EAAA,IAGA,KAAA,CAAA,QAAAlC,EAAA,OACA,UAAA,mCACA,SAAAO,CAEA,CAAA,CAAA,CAAA,EAEAN,EAAA,SAAA,EACAiC,EAAA,IAAA,KAAA,CAAA,SAAAA,EAAA,IAGA,KAAA,CAAA,QAAAlC,EAAA,OACA,UAAA,mCACA,SAAAM,CAEA,CAAA,CAAA,CAAA,EAEAwB,EAAA,YAAA,EAAA,KAAA,IAAAmB,GAMAf,EAAA,IACA,KAAA,CAAA,UAAA,+EAAA1B,EAAA,0GAAA,EAAA,GAEA,QAAAA,EAAA,IAAAA,EAAAyC,EAAA,QAAA,EAAA,OAEA,SAAAA,EAAA,gBAAA,EAAA,IAAAC,GAAAhB,EAAA,IAAA,KAAA,CAAA,SAAAQ,EAKAQ,EAAA,OAAA,UAAA,KACAA,EAAA,WAAA,CACA,CAAA,EAAAA,EAAA,EAAA,CAAA,CAGA,EAAAD,EAAA,EAbA,CAcA,CAEA,CAAA,CAEA,CAAA,CAAA,CAAA,CAAA,CAIA"}