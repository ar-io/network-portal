import{r as t,a as E,G as Se,N as Q,R as v,b as ie,n as ne,u as oe,j as e,c as de,T as L,d as C,E as ce,t as me,S as pe,q as $,s as G,C as xe,m as ue,B as ge,p as be,w as ke,x as Ee,y as Ne,W as Ce,M as Ae,D as _e,Q as De,K as Ie,f as Oe,P as Y,H as Me}from"./index-DT_KQEYq.js";import{u as Z,L as W,S as J}from"./useDelegateStakes-D2fz13wy.js";import{A as H}from"./AddressCell-D_f8F7jC.js";import{C as he}from"./ColumnSelector-BmbWJT6C.js";import{T as q,c as K,u as Fe,R as X,a as ee,C as te,I as T}from"./index-tbIpH_Tt.js";import{h as fe,M as we,S as ve,g as ye,a as Re,V as ae,C as se,b as re,d as We,W as Te,f as Be,I as Pe,e as Le}from"./StakingModal-0EdW_tTe.js";import{D as $e}from"./Dropdown-DDaUOJ8r.js";import{E as Ge,Q as le,g as Ue}from"./validation-DxHxJWOA.js";import{S as Ve}from"./observers_connect_icon-Cc0GemO2.js";import"./search-CFp1EMlw.js";import"./chevron-down-CWFu1ckq.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[o]="f5819950-3180-4748-4025-3fad1ce613cf",l._sentryDebugIdIdentifier="sentry-dbid-f5819950-3180-4748-4025-3fad1ce613cf")}catch{}})();const ze=l=>t.createElement("svg",{width:1440,height:941,viewBox:"40 0 1440 941",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},t.createElement("g",{filter:"url(#filter0_ddddd_2683_6709)"},t.createElement("g",{clipPath:"url(#clip0_2683_6709)"},t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M790 735L790 -89H789L789 735H790ZM774 735L774 106H773L773 735H774ZM742 735L742 182H741L741 735H742ZM726 -13L726 735H725L725 -13H726ZM710 735L710 290H709L709 735H710Z",fill:"url(#paint1_linear_2683_6709)",fillOpacity:.25}),t.createElement("line",{x1:789.5,y1:735,x2:789.5,y2:-37,stroke:"url(#paint2_linear_2683_6709)"}),t.createElement("path",{opacity:.8,d:"M757.499 735L755.564 95.9288",stroke:"url(#paint3_linear_2683_6709)"}),t.createElement("line",{opacity:.1,x1:725.5,y1:735,x2:725.5,y2:56,stroke:"url(#paint4_linear_2683_6709)"}),t.createElement("line",{opacity:.2,x1:805.5,y1:735,x2:805.5,y2:141,stroke:"url(#paint5_linear_2683_6709)"}),t.createElement("line",{opacity:.5,x1:741.5,y1:735,x2:741.5,y2:182,stroke:"url(#paint6_linear_2683_6709)"}),t.createElement("line",{opacity:.4,x1:773.5,y1:735,x2:773.5,y2:106,stroke:"url(#paint7_linear_2683_6709)"}),t.createElement("line",{opacity:.8,x1:709.5,y1:735,x2:715.938,y2:162,stroke:"url(#paint8_linear_2683_6709)"}),t.createElement("ellipse",{cx:753,cy:147,rx:135.721,ry:47.833,fill:"url(#paint9_radial_2683_6709)"})),t.createElement("rect",{x:90.5,y:83.5,width:1325,height:133,rx:11.5,stroke:"url(#paint10_linear_2683_6709)"})),t.createElement("defs",null,t.createElement("filter",{id:"filter0_ddddd_2683_6709",x:-393,y:0,width:2292,height:2426,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},t.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:69}),t.createElement("feGaussianBlur",{stdDeviation:76}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.29 0"}),t.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_2683_6709"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:276}),t.createElement("feGaussianBlur",{stdDeviation:138}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.26 0"}),t.createElement("feBlend",{mode:"normal",in2:"effect1_dropShadow_2683_6709",result:"effect2_dropShadow_2683_6709"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:621}),t.createElement("feGaussianBlur",{stdDeviation:186.5}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0"}),t.createElement("feBlend",{mode:"normal",in2:"effect2_dropShadow_2683_6709",result:"effect3_dropShadow_2683_6709"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:1105}),t.createElement("feGaussianBlur",{stdDeviation:221}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.04 0"}),t.createElement("feBlend",{mode:"normal",in2:"effect3_dropShadow_2683_6709",result:"effect4_dropShadow_2683_6709"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:1726}),t.createElement("feGaussianBlur",{stdDeviation:241.5}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.01 0"}),t.createElement("feBlend",{mode:"normal",in2:"effect4_dropShadow_2683_6709",result:"effect5_dropShadow_2683_6709"}),t.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect5_dropShadow_2683_6709",result:"shape"})),t.createElement("linearGradient",{id:"paint0_linear_2683_6709",x1:539,y1:83,x2:998.042,y2:318.345,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#1D1D1F"}),t.createElement("stop",{offset:1,stopColor:"#0E0E0F"})),t.createElement("linearGradient",{id:"paint1_linear_2683_6709",x1:715.408,y1:561.527,x2:790.846,y2:561.346,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint2_linear_2683_6709",x1:790.789,y1:673.924,x2:752.713,y2:671.902,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint3_linear_2683_6709",x1:757.092,y1:684.441,x2:684.303,y2:675.402,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint4_linear_2683_6709",x1:726.789,y1:681.282,x2:688.744,y2:678.984,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint5_linear_2683_6709",x1:806.789,y1:688.006,x2:768.786,y2:685.383,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint6_linear_2683_6709",x1:742.789,y1:691.25,x2:704.814,y2:688.435,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint7_linear_2683_6709",x1:774.789,y1:685.237,x2:736.767,y2:682.759,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint8_linear_2683_6709",x1:715.083,y1:689.668,x2:512.283,y2:596.245,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("radialGradient",{id:"paint9_radial_2683_6709",cx:0,cy:0,r:1,gradientUnits:"userSpaceOnUse",gradientTransform:"translate(753 147) rotate(90) scale(72.7222 206.342)"},t.createElement("stop",{offset:.25,stopColor:"#19191C",stopOpacity:.9}),t.createElement("stop",{offset:.707422,stopColor:"#19191C",stopOpacity:.25})),t.createElement("clipPath",{id:"clip0_2683_6709"},t.createElement("rect",{x:90,y:83,width:1326,height:134,rx:12,fill:"white"})))),Ye=l=>{const o=E(c=>c.arIOReadSDK),[m,p]=t.useState(),{data:n}=Se();return t.useEffect(()=>{o&&n&&l&&(async()=>{const u=n.sort((f,a)=>((f==null?void 0:f.epochIndex)||0)-((a==null?void 0:a.epochIndex)||0)),i=u[u.length-2],h=i==null?void 0:i.distributions,d=h&&Q(h)?h.rewards.distributed??{}:void 0,j=(d==null?void 0:d[l])??0,y=n.reduce((f,a)=>{const r=a==null?void 0:a.distributions,w=r&&Q(r)?r.rewards.distributed??{}:{};return f+(w[l]||0)},0);p({previousEpoch:new v(j).toARIO().valueOf(),totalForPastAvailableEpochs:new v(y).toARIO().valueOf()})})()},[n,l,o]),m},_=K(),je=()=>{const l=E(a=>a.walletAddress),o=E(a=>a.ticker),{isLoading:m,data:p}=ie(),[n,c]=t.useState([]),[u,i]=t.useState(),[h,d]=t.useState(!1),{data:j}=ne(),y=oe();t.useEffect(()=>{const a=!p||!j?[]:Object.entries(p).filter(r=>r[1].status==="joined").reduce((r,[w,x])=>{if(x.settings.allowDelegatedStaking){const N=x.stats.passedEpochCount,S=x.stats.totalEpochCount;return[...r,{label:x.settings.label,domain:x.settings.fqdn,owner:w,streak:x.stats.failedConsecutiveEpochs>0?-x.stats.failedConsecutiveEpochs:x.stats.passedConsecutiveEpochs,rewardShareRatio:x.settings.allowDelegatedStaking?x.settings.delegateRewardShareRatio:-1,performance:S>0?x.stats.passedEpochCount/S:-1,passedEpochCount:N,totalEpochCount:S,totalDelegatedStake:new v(x.totalDelegatedStake).toARIO().valueOf(),operatorStake:new v(x.operatorStake).toARIO().valueOf(),totalStake:new v(x.totalDelegatedStake+x.operatorStake).toARIO().valueOf(),eay:fe(new v(j).toARIO(),Object.values(p).filter(D=>D.status=="joined").length,x).EAY}]}return r},[]);c(a)},[p,j,l]);const f=t.useMemo(()=>[_.accessor("label",{id:"label",header:"Label",sortDescFirst:!1}),_.accessor("domain",{id:"domain",header:"Domain",sortDescFirst:!1,cell:({row:a})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://${a.getValue("domain")}`,target:"_blank",rel:"noreferrer",onClick:r=>{r.stopPropagation()},className:"text-gradient",children:a.getValue("domain")}),e.jsx(de,{textToCopy:a.getValue("domain")})]})}),_.accessor("owner",{id:"owner",header:"Address",sortDescFirst:!1,cell:({row:a})=>e.jsx(H,{address:a.getValue("owner")})}),_.accessor("totalStake",{id:"totalStake",header:`Total Stake (${o})`,sortDescFirst:!0,cell:({row:a})=>e.jsx(L,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["Operator Stake: ",C(a.original.operatorStake)," ",o]}),e.jsxs("div",{className:"mt-1",children:["Delegated Stake:"," ",C(a.original.totalDelegatedStake)," ",o]})]}),children:C(a.getValue("totalStake"))})}),_.accessor("rewardShareRatio",{id:"rewardShareRatio",header:"Reward Share Ratio",sortDescFirst:!0,cell:({row:a})=>a.original.rewardShareRatio>=0?`${a.original.rewardShareRatio}%`:"N/A"}),_.accessor("eay",{id:"eay",meta:{displayName:"Delegate EAY"},header:()=>e.jsxs("div",{className:"flex gap-1",children:["Delegate EAY",e.jsx(L,{message:e.jsxs("div",{children:[e.jsx("p",{children:ce}),e.jsx(we,{className:"mt-4",children:me})]}),children:e.jsx(ve,{className:"h-full"})})]}),sortDescFirst:!0,cell:({row:a})=>e.jsx("div",{children:a.original.eay<0?"N/A":`${C(a.original.eay*100)}%`})}),_.accessor("performance",{id:"performance",header:"Performance",sortDescFirst:!0,cell:({row:a})=>a.original.performance<0?"N/A":e.jsx(L,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["Passed Epoch Count: ",a.original.passedEpochCount]}),e.jsxs("div",{className:"mt-1",children:["Total Epoch Participation Count:"," ",a.original.totalEpochCount]})]}),children:`${(a.original.performance*100).toFixed(2)}%`})}),_.accessor("streak",{id:"streak",header:"Streak",sortDescFirst:!0,cell:({row:a})=>e.jsx(pe,{streak:a.original.streak})}),_.display({id:"action",header:"",cell:({row:a})=>{const r=a.original.owner===(l==null?void 0:l.toString()),w=e.jsx($,{buttonType:G.PRIMARY,active:!0,title:"Manage Stake",text:"Stake",onClick:x=>{x.stopPropagation(),l?r||i(a.getValue("owner")):d(!0)}});return e.jsx("div",{className:"pr-6",children:r?e.jsx(L,{message:"Delegate staking is not supported for gateways you operate. Please use operator staking on your gateway details page.",children:e.jsx("div",{className:"pointer-events-none opacity-30",children:w})}):w})}})],[o,l,i,d]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex w-full items-center rounded-t-xl border border-grey-600 bg-containerL3 py-2 pl-6 pr-3",children:[e.jsx("div",{className:"grow text-sm text-mid",children:"Delegate Stake"}),e.jsx(he,{tableId:"delegate-stake",columns:f})]}),e.jsx(q,{columns:f,data:n,isLoading:m,noDataFoundText:"No stakeable gateways found.",defaultSortingState:{id:"totalStake",desc:!0},onRowClick:a=>{y(`/gateways/${a.owner}`)},tableId:"delegate-stake"}),u&&e.jsx(ye,{open:!!u,onClose:()=>i(void 0),ownerWallet:u}),h&&e.jsx(xe,{onClose:()=>d(!1)})]})},He=({onClose:l,ownerWallet:o})=>{const m=E(b=>b.walletAddress),{data:p}=ue(m),n=E(b=>b.ticker),[c,u]=t.useState(0),[i,h]=t.useState(""),[d,j]=t.useState("standard"),[y,f]=t.useState(!1),{data:a}=Fe({ownerWalletAddress:o}),{data:r}=Z(m==null?void 0:m.toString());t.useEffect(()=>{var s;if(!a||!r)return;const b=(s=r.stakes.find(g=>g.gatewayAddress===a.gatewayAddress))==null?void 0:s.balance;u(new v(b??0).toARIO().valueOf())},[r,a]);const w=(a==null?void 0:a.settings.allowDelegatedStaking)??!1,x=a?new v(a==null?void 0:a.settings.minDelegatedStake).toARIO().valueOf():10,N=c>0?1:x,S=d==="expedited"?.5*parseFloat(i):0,D=isNaN(parseFloat(i))?"-":+(isNaN(S)?parseFloat(i):parseFloat(i)-S).toFixed(4),I={withdrawAmount:Ue("Withdraw Amount",n,c,x)},F=()=>a?I.withdrawAmount(i)==null:!1,U=parseFloat(i.length===0?"0":i),A=c-U,P=()=>{h(c+"")},R=!a||c<=0,V={withdrawAmount:I.withdrawAmount(i),cannotStake:((p==null?void 0:p.ario)||0)<N?`Insufficient balance, at least ${N} IO required.`:w?void 0:"Gateway does not allow delegated staking."};return e.jsx(ge,{onClose:l,useDefaultPadding:!1,children:e.jsxs("div",{className:"w-[calc(100vw-2rem)] lg:w-[28.5rem]",children:[e.jsx("div",{className:"border-b border-b-stroke-low",children:e.jsx("div",{className:"rounded-tr-xl border-b border-red-400 bg-grey-700 py-3 text-center",children:e.jsx("span",{className:"text-gradient",children:"Withdraw"})})}),e.jsxs("div",{className:"flex flex-col p-8 pb-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(W,{label:"Gateway Owner:",value:be(o)}),e.jsx(W,{label:"Label:",value:a?a.settings.label:"-"}),e.jsx(W,{label:"Domain:",isLink:!0,value:a?a.settings.fqdn:"-"})]}),e.jsxs("div",{className:"mt-8 flex items-center",children:[e.jsx("div",{className:"text-left text-sm text-mid",children:"Amount:"}),e.jsx("div",{className:"grow"}),e.jsx("div",{className:"text-left text-xs text-low",children:`Available to Withdraw: ${A>=0?C(A):"-"} ${n}`})]}),e.jsxs("div",{className:"mt-3 flex h-[3.25rem] items-center overflow-hidden rounded-md border border-grey-800",children:[e.jsx("input",{className:"size-full grow  bg-grey-1000 px-6 py-3 text-sm text-mid outline-none placeholder:text-grey-400 focus:text-high",disabled:R,readOnly:R,type:"text",placeholder:`Enter amount of ${n} to withdraw`,value:i,onChange:b=>{const s=b.target.value;s&&isNaN(+b.target.value)||h(s)}}),(i==null?void 0:i.length)>0&&V.withdrawAmount&&e.jsx(Ge,{errorMessage:V.withdrawAmount,tooltipPadding:"3"}),e.jsx($,{className:"mr-3 h-7",onClick:R?void 0:P,buttonType:G.SECONDARY,active:!0,title:"Max",text:"Max"})]}),e.jsx("div",{className:"mt-4 flex flex-col gap-2",children:e.jsxs(Re,{className:"my-2 flex flex-col gap-4 text-sm",value:d,onChange:b=>j(b),children:[e.jsx(ae,{value:"standard",className:`group flex w-full cursor-pointer rounded 
                  from-gradient-primary-start to-gradient-primary-end data-[checked]:bg-gradient-to-r`,children:e.jsxs("div",{className:"m-px flex size-full flex-col gap-1 rounded  bg-containerL3 px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"visible size-4 group-data-[checked]:hidden"}),e.jsx(re,{className:"hidden size-4 group-data-[checked]:block"}),e.jsx(le,{children:"Standard Withdrawal"})]}),e.jsx("p",{className:"pl-6 text-left text-xs text-mid",children:"90 day withdrawal period with no fees."})]})}),e.jsx(ae,{value:"expedited",className:`group flex w-full cursor-pointer rounded 
                  from-gradient-primary-start to-gradient-primary-end data-[checked]:bg-gradient-to-r`,children:e.jsxs("div",{className:"m-px flex size-full flex-col gap-1 rounded  bg-containerL3 px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"visible size-4 group-data-[checked]:hidden"}),e.jsx(re,{className:"hidden size-4 group-data-[checked]:block"}),e.jsx(le,{children:"Expedited Withdrawal"})]}),e.jsx("p",{className:"pl-6 text-left text-xs text-mid",children:"Instant withdrawal with 50% fee."})]})})]})})]}),e.jsxs("div",{className:"flex size-full flex-col gap-2 bg-containerL0 px-8 pb-8 pt-4",children:[d=="expedited"&&e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"first:text-mid last:text-mid",label:"Fee:",value:`${isNaN(S)?"-":+S.toFixed(4)} ${n}`}),e.jsx(W,{className:"first:text-mid last:text-mid",label:"Returning Amount:",value:`${D} ${n}`})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(W,{label:"New Total Stake:",value:`${F()?C(c-parseFloat(i)):"-"} ${n}`})}),e.jsx("div",{className:F()?void 0:"pointer-events-none opacity-30",children:e.jsx($,{className:"mt-4 h-[3.25rem] w-full",onClick:()=>{f(!0)},buttonType:G.PRIMARY,title:"Review",text:"Review"})})]}),y&&a&&m&&e.jsx(We,{amountToWithdraw:parseFloat(i),withdrawalType:d,gateway:a,onClose:()=>f(!1),onSuccess:()=>l(),ticker:n,walletAddress:m,withdrawalFee:S,returningAmount:D})]})})},qe=({onClose:l,activeStakes:o})=>{const m=ke(),[p,n]=t.useState(!1),[c,u]=t.useState(!1),i=E(r=>r.walletAddress),h=E(r=>r.arIOWriteableSDK),d=E(r=>r.ticker),y=o.sort((r,w)=>w.delegatedStake-r.delegatedStake).filter(r=>r.delegatedStake>0),f=o.reduce((r,w)=>r+w.delegatedStake,0),a=async()=>{if(i&&h){n(!0);try{for(const r of y)if(r.delegatedStake>0){const{id:w}=await h.decreaseDelegateStake({target:r.owner,decreaseQty:r.delegatedStake},Ce);Ae.info(`Decrease Delegate Stake txID: ${w}`)}m.invalidateQueries({queryKey:["gateway",i.toString()],refetchType:"all"}),m.invalidateQueries({queryKey:["gateways"],refetchType:"all"}),m.invalidateQueries({queryKey:["delegateStakes"],refetchType:"all"}),u(!0)}catch(r){_e(`${r}`)}finally{n(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{onClose:l,useDefaultPadding:!1,children:e.jsxs("div",{className:"w-[calc(100vw-2rem)] text-left lg:w-[28.4375rem]",children:[e.jsxs("div",{className:"px-8  pb-4 pt-6",children:[e.jsx("div",{className:"text-lg text-high",children:"Withdraw All"}),e.jsx("div",{className:"flex pt-2 text-xs text-low",children:"Withdraw all delegated stakes."})]}),e.jsxs("div",{className:"border-y border-grey-800 p-8",children:[e.jsx("table",{className:"mb-8 w-full table-auto",children:y.map((r,w)=>e.jsxs("tr",{className:"text-sm",children:[e.jsx("td",{className:"py-2 text-low ",children:r.gateway.settings.label}),e.jsx("td",{className:"py-2",children:e.jsx("a",{className:"text-gradient",href:`https://${r.gateway.settings.fqdn}`,target:"_blank",rel:"noreferrer",children:r.gateway.settings.fqdn})}),e.jsxs("td",{className:"py-2 text-right text-mid ",children:[new v(r.delegatedStake).toARIO().valueOf()," ",d]})]},w))}),e.jsx(Te,{})]}),e.jsxs("div",{className:"bg-containerL0 px-8 pb-8 pt-6",children:[e.jsxs("div",{className:"mt-1 flex text-sm text-mid",children:[e.jsx("div",{className:"grow",children:"Total Withdrawal:"}),e.jsxs("div",{children:[new v(f).toARIO().valueOf()," ",d]})]}),e.jsx("div",{className:"mt-6 flex grow justify-center",children:e.jsx($,{onClick:a,buttonType:G.PRIMARY,title:"Withdraw",text:e.jsx("div",{className:"py-2",children:"Withdraw"}),className:"w-full"})})]})]})}),p&&e.jsx(Ee,{onClose:()=>n(!1),message:"Sign the following data with your wallet to proceed."}),c&&e.jsx(Ne,{onClose:()=>{u(!1),l()},title:"Congratulations",bodyText:"You have successfully withdrawn all stakes."})]})},M=K(),B=K(),Ze=()=>{const l=E(s=>s.walletAddress),o=E(s=>s.ticker),{isFetching:m,data:p}=ie(),[n,c]=t.useState(),[u,i]=t.useState(),[h,d]=t.useState("activeStakes"),[j,y]=t.useState(!1),[f,a]=t.useState(),[r,w]=t.useState(),[x,N]=t.useState(),[S,D]=t.useState(),[I,F]=t.useState(),U=oe(),{data:A}=Z(l==null?void 0:l.toString()),{data:P}=ne();t.useEffect(()=>{const s=m?void 0:!A||!p||!P?[]:A.stakes.filter(k=>k.balance>0).map(k=>{const O=p[k.gatewayAddress];return{owner:k.gatewayAddress,delegatedStake:k.balance,gateway:{...O,gatewayAddress:k.gatewayAddress},pendingWithdrawals:A.withdrawals.filter(z=>z.gatewayAddress==k.gatewayAddress).length,streak:O.status=="leaving"?Number.NEGATIVE_INFINITY:O.stats.failedConsecutiveEpochs>0?-O.stats.failedConsecutiveEpochs:O.stats.passedConsecutiveEpochs,eay:fe(new v(P).toARIO(),Object.values(p).filter(z=>z.status=="joined").length,O).EAY}}),g=m?void 0:!A||!p?[]:A.withdrawals.map(k=>{const O=p[k.gatewayAddress];return{owner:k.gatewayAddress,gateway:{...O,gatewayAddress:k.gatewayAddress},withdrawal:k,withdrawalId:k.vaultId}});c(s),i(g)},[A,p,m,P]);const R=t.useMemo(()=>[M.accessor("gateway.settings.label",{id:"label",header:"Label",sortDescFirst:!1}),M.accessor("gateway.settings.fqdn",{id:"domain",header:"Domain",sortDescFirst:!1,cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://${s.getValue("domain")}`,target:"_blank",rel:"noreferrer",onClick:g=>{g.stopPropagation()},className:"text-gradient",children:s.getValue("domain")}),e.jsx(de,{textToCopy:s.getValue("domain")})]})}),M.accessor("owner",{id:"owner",header:"Address",sortDescFirst:!1,cell:({row:s})=>e.jsx(H,{address:s.getValue("owner")})}),M.accessor("delegatedStake",{id:"delegatedStake",header:`Current Stake (${o})`,sortDescFirst:!0,cell:({row:s})=>`${new v(s.original.delegatedStake).toARIO().valueOf()}`}),M.accessor("eay",{id:"eay",meta:{displayName:"Delegate EAY"},header:()=>e.jsxs("div",{className:"flex gap-1",children:["Delegate EAY",e.jsx(L,{message:e.jsxs("div",{children:[e.jsx("p",{children:ce}),e.jsx(we,{className:"mt-4",children:me})]}),children:e.jsx(ve,{className:"h-full"})})]}),sortDescFirst:!0,cell:({row:s})=>e.jsx("div",{children:s.original.eay<0?"N/A":`${C(s.original.eay*100)}%`})}),M.accessor("streak",{id:"streak",header:"Streak",sortDescFirst:!0,cell:({row:s})=>e.jsx(pe,{streak:s.original.streak})}),M.accessor("pendingWithdrawals",{id:"pendingWithdrawals",header:"Pending Withdrawals",sortDescFirst:!0,cell:({row:s})=>e.jsx("div",{className:s.original.pendingWithdrawals>0?"text-high":"text-low",children:`${s.original.pendingWithdrawals}`})}),M.display({id:"action",header:"",cell:({row:s})=>e.jsx("div",{className:"flex w-full justify-end pr-6",children:e.jsxs(X,{modal:!1,children:[e.jsx(ee,{asChild:!0,onClick:g=>g.stopPropagation(),children:e.jsx("div",{className:"cursor-pointer rounded-md bg-gradient-to-b from-btn-primary-outer-gradient-start to-btn-primary-outer-gradient-end  p-px",children:e.jsx("div",{className:"inline-flex size-full items-center justify-start gap-[0.6875rem] rounded-md bg-btn-primary-base bg-gradient-to-b from-btn-primary-gradient-start to-btn-primary-gradient-end px-[0.3125rem] py-[.3125rem] shadow-inner",children:e.jsx(J,{className:"size-4"})})})}),e.jsxs(te,{className:"z-50 rounded border border-grey-500 bg-containerL0 text-sm",children:[e.jsx(T,{className:"cursor-pointer select-none px-4 py-2 outline-none  data-[highlighted]:bg-containerL3",onClick:g=>{g.stopPropagation(),a(s.original.owner)},children:"Add Stake"}),e.jsx(T,{className:"cursor-pointer select-none px-4 py-2 outline-none  data-[highlighted]:bg-containerL3",onClick:g=>{g.stopPropagation(),w(s.original.owner)},children:"Withdraw Stake"}),e.jsx(T,{className:"cursor-pointer select-none  px-4 py-2 outline-none  data-[highlighted]:bg-containerL3",onClick:g=>{g.stopPropagation(),N({sourceGateway:s.original.gateway,onClose:()=>N(void 0),maxRedelegationStake:new v(s.original.delegatedStake).toARIO()})},children:"Redelegate"})]})]})})})],[o,a,w,N]),V=(n==null?void 0:n.some(s=>s.delegatedStake>0))??!1,b=t.useMemo(()=>[B.accessor("gateway.settings.label",{id:"label",header:"Label",sortDescFirst:!1}),B.accessor("gateway.settings.fqdn",{id:"domain",header:"Domain",sortDescFirst:!1,cell:({row:s})=>e.jsxs("div",{className:"text-gradient",children:[e.jsx("a",{href:`https://${s.getValue("domain")}`,target:"_blank",rel:"noreferrer",onClick:g=>g.stopPropagation(),children:s.getValue("domain")})," "]})}),B.accessor("owner",{id:"owner",header:"Address",sortDescFirst:!1,cell:({row:s})=>e.jsx(H,{address:s.getValue("owner")})}),B.accessor("withdrawal.balance",{id:"withdrawal",header:`Stake Withdrawing (${o})`,sortDescFirst:!0,cell:({row:s})=>`${new v(s.original.withdrawal.balance).toARIO().valueOf()}`}),B.accessor(s=>s.withdrawal.endTimestamp,{id:"endDate",header:"Date Returning",sortDescFirst:!0,cell:({row:s})=>`${De(new Date(s.original.withdrawal.endTimestamp)).format("YYYY-MM-DD")}`}),B.display({id:"actions",cell:({row:s})=>e.jsx("div",{className:"flex w-full justify-end pr-6",children:e.jsxs(X,{modal:!1,children:[e.jsx(ee,{asChild:!0,onClick:g=>g.stopPropagation(),children:e.jsx("div",{className:"cursor-pointer rounded-md bg-gradient-to-b from-btn-primary-outer-gradient-start to-btn-primary-outer-gradient-end  p-px",children:e.jsx("div",{className:"inline-flex size-full items-center justify-start gap-[0.6875rem] rounded-md bg-btn-primary-base bg-gradient-to-b from-btn-primary-gradient-start to-btn-primary-gradient-end px-[0.3125rem] py-[.3125rem] shadow-inner",children:e.jsx(J,{className:"size-4"})})})}),e.jsxs(te,{className:"z-50 rounded border border-grey-500 bg-containerL0 text-sm",children:[e.jsx(T,{className:"cursor-pointer select-none px-4 py-2 outline-none  data-[highlighted]:bg-containerL3",onClick:g=>{g.stopPropagation(),F({gateway:s.original.gateway,gatewayAddress:s.original.owner,vault:s.original.withdrawal,vaultId:s.original.withdrawalId})},children:"Expedite Withdrawal"}),e.jsx(T,{className:"cursor-pointer select-none px-4 py-2 outline-none  data-[highlighted]:bg-containerL3",onClick:g=>{g.stopPropagation(),D({gatewayAddress:s.original.owner,vaultId:s.original.withdrawalId})},children:"Cancel Withdrawal"}),e.jsx(T,{className:"cursor-pointer select-none  px-4 py-2 outline-none  data-[highlighted]:bg-containerL3",onClick:g=>{g.stopPropagation(),N({sourceGateway:s.original.gateway,onClose:()=>N(void 0),maxRedelegationStake:new v(s.original.withdrawal.balance).toARIO(),vaultId:s.original.withdrawalId})},children:"Redelegate"})]})]})})})],[o,F,D,N]);return e.jsxs("div",{children:[e.jsxs("div",{className:`flex w-full items-center gap-4 rounded-t-xl border border-grey-600 bg-containerL3 pl-6 pr-3 ${h=="activeStakes"?"py-2":"py-[0.9375rem]"} `,children:[e.jsx("div",{className:"grow text-sm text-mid",children:e.jsx($e,{options:[{label:"Active Stakes",value:"activeStakes"},{label:"Pending Withdrawals",value:"pendingWithdrawals"}],onChange:s=>{d(s.target.value)},value:h,tightPadding:!0})}),e.jsxs("div",{className:"flex items-center gap-3",children:[h=="activeStakes"&&V&&e.jsx($,{buttonType:G.SECONDARY,className:"*:text-gradient-red h-[1.875rem]",active:!0,title:"Withdraw All",text:"Withdraw All",onClick:()=>y(!0)}),e.jsx(he,{tableId:h==="activeStakes"?"my-stakes-active":"my-stakes-withdrawals",columns:h==="activeStakes"?R:b})]})]}),h==="activeStakes"?e.jsx(q,{columns:R,data:n||[],isLoading:m||n===void 0,noDataFoundText:"No active stakes found.",defaultSortingState:{id:"delegatedStake",desc:!0},onRowClick:s=>{U(`/gateways/${s.owner}`)},tableId:"my-stakes-active"},"activeStakesTable"):e.jsx(q,{columns:b,data:u||[],isLoading:m||u===void 0,noDataFoundText:"No pending withdrawals found.",defaultSortingState:{id:"label",desc:!0},onRowClick:s=>{U(`/gateways/${s.owner}`)},tableId:"my-stakes-withdrawals"},"pendingWithdrawalsTable"),j&&n!==void 0&&e.jsx(qe,{activeStakes:n,onClose:()=>y(!1)}),f&&e.jsx(ye,{open:!!f,onClose:()=>{a(void 0)},ownerWallet:f}),r&&e.jsx(He,{open:!!r,onClose:()=>{w(void 0)},ownerWallet:r}),S&&e.jsx(Be,{gatewayAddress:S.gatewayAddress,vaultId:S.vaultId,onClose:()=>D(void 0)}),I&&e.jsx(Pe,{gateway:I.gateway,gatewayAddress:I.gatewayAddress,vaultId:I.vaultId,vault:I.vault,onClose:()=>F(void 0)}),x&&e.jsx(Le,{...x})]})},Ke=({title:l,value:o,ticker:m,leftTitle:p,leftValue:n,rightTitle:c,rightValue:u,epochZeroStartTimestamp:i,hasEpochZeroStarted:h=!0})=>e.jsxs("div",{className:"rounded-xl border border-grey-600 px-6 pb-5 pt-10 text-center",children:[e.jsx("div",{className:"text-sm text-mid",children:l}),i&&!h?e.jsx("div",{className:"mb-6 h-[2.6rem]",children:e.jsxs("div",{className:"flex size-full items-center justify-center self-center text-center text-sm italic text-low",children:["Staking rewards begin on"," ",Oe(new Date(i))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto mb-1 mt-3 flex w-fit gap-2",children:[e.jsx("div",{className:"text-[2.6rem] leading-none text-high",children:o??e.jsx("div",{className:"h-[2.6rem]",children:e.jsx(Y,{className:"m-auto"})})}),e.jsx("div",{className:"text-sm text-high",children:m})]}),e.jsxs("div",{className:"flex justify-between align-bottom font-bold text-high",children:[e.jsxs("div",{className:"flex flex-col place-items-start text-left text-xs",children:[e.jsx("div",{className:"grow"}),p&&(n!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-mid",children:n}),e.jsx("div",{className:"text-low",children:p})]}):e.jsx(Y,{}))]}),e.jsxs("div",{className:"flex flex-col place-items-end text-right text-xs",children:[e.jsx("div",{className:"grow"}),c&&(u!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-mid",children:u}),e.jsx("div",{className:"text-low",children:c})]}):e.jsx(Y,{}))]})]})]})]}),Qe=()=>{const l=E(d=>d.walletAddress),o=E(d=>d.ticker),[m,p]=t.useState(),{data:n}=ue(l),c=Ye(l==null?void 0:l.toString()),{data:u}=Ie(),{data:i}=Z(l==null?void 0:l.toString());t.useEffect(()=>{if(i){const d=i.stakes.reduce((y,f)=>y+f.balance,0),j=i.withdrawals.reduce((y,f)=>y+f.balance,0);p(new v(d+j).toARIO().valueOf())}},[i]);const h=[{title:"Your Balance",balance:n?C(n.ario):void 0},{title:"Amount Staking + Pending Withdrawals",balance:m!==void 0?C(m):void 0},{title:"Total Rewards Earned (Last 14 Epochs)",balance:(c==null?void 0:c.totalForPastAvailableEpochs)!==void 0?C(c.totalForPastAvailableEpochs):void 0,leftTitle:"LAST EPOCH",leftValue:(c==null?void 0:c.previousEpoch)!==void 0?`${C(c.previousEpoch)} ${o}`:void 0,epochZeroStartTimestamp:u==null?void 0:u.epochZeroStartTimestamp,hasEpochZeroStarted:u?u.hasEpochZeroStarted:!0}];return e.jsxs("div",{className:"flex flex-col gap-6 pb-6",children:[e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:h.map((d,j)=>e.jsx(Ke,{title:d.title,value:d.balance,ticker:o,leftTitle:d.leftTitle,leftValue:d.leftValue,epochZeroStartTimestamp:d.epochZeroStartTimestamp,hasEpochZeroStarted:d.hasEpochZeroStarted},j))}),e.jsx(Ze,{}),e.jsx(je,{})]})},Je=()=>{const[l,o]=t.useState(!1);return e.jsxs("div",{children:[e.jsxs("button",{className:"group relative flex h-[7.5rem] w-full justify-center overflow-hidden rounded-xl bg-grey-800",onClick:()=>{o(!0)},children:[e.jsx(ze,{className:"absolute top-[-5.625rem] h-[58.1875rem] w-[90rem]  opacity-80"}),e.jsx("div",{className:`invisible size-full rounded-xl
       bg-gradient-to-r from-gradient-primary-start to-gradient-primary-end p-px group-hover:visible`,children:e.jsx("div",{className:"size-full overflow-hidden rounded-xl bg-grey-800"})}),e.jsxs("div",{className:"absolute top-0 z-10 flex size-full flex-col items-center justify-center bg-transparent py-6 align-middle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"size-4"}),e.jsx("div",{className:"text-gradient",children:"Connect your wallet to start staking"})," "]}),e.jsx("div",{className:"pt-2 text-sm text-low",children:"By delegating stake to a gateway, you can participate in the network's reward system."})]})]}),l&&e.jsx(xe,{onClose:()=>o(!1)})]})},Xe=()=>e.jsxs("div",{className:"flex max-w-full flex-col gap-6 overflow-y-auto py-6 scrollbar",children:[e.jsx(Je,{}),e.jsx(je,{})]}),mt=()=>{const l=E(o=>o.walletAddress);return e.jsxs("div",{className:"flex h-full max-w-full flex-col",children:[e.jsx("div",{className:"mb-6 shrink-0",children:e.jsx(Me,{})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:"pt-0",children:l?e.jsx(Qe,{}):e.jsx(Xe,{})})})})]})};export{mt as default};
//# sourceMappingURL=index-D7vYaoF6.js.map
