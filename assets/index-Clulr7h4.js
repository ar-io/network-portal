import{r as m,V as h,aH as E,a as b,v as S,j as r,g as I,J as T,aI as O,aJ as H,aK as L,M as R,aL as P,i as A,L as g,P as B,k as _,l as k,q as V,s as $,D as q}from"./index-DT_KQEYq.js";import{B as x,A as U}from"./AssessmentDetailsPanel-Ba37u3cp.js";import{T as W,c as M,u as F}from"./index-tbIpH_Tt.js";import{C as G}from"./ColumnSelector-BmbWJT6C.js";import{C as y}from"./chevron-right-Dn4_GTmY.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s=new Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="0eae61a6-46e5-4e94-beab-34bf112b08c6",e._sentryDebugIdIdentifier="sentry-dbid-0eae61a6-46e5-4e94-beab-34bf112b08c6")}catch{}})();const K=e=>m.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},m.createElement("g",{id:"Binoculars"},m.createElement("path",{id:"Vector",d:"M14.825 9.49212C14.7833 9.3756 14.7342 9.26184 14.6781 9.15149L12.0787 3.23774C12.0542 3.18079 12.0189 3.12903 11.975 3.08524C11.7893 2.89948 11.5688 2.75212 11.3261 2.65158C11.0834 2.55104 10.8233 2.4993 10.5606 2.4993C10.2979 2.4993 10.0378 2.55104 9.79515 2.65158C9.55247 2.75212 9.33197 2.89948 9.14625 3.08524C9.05281 3.17879 9.00023 3.30553 9 3.43774V5.00024H7V3.43774C7.00005 3.37206 6.98716 3.30702 6.96207 3.24632C6.93697 3.18562 6.90017 3.13046 6.85375 3.08399C6.66803 2.89823 6.44753 2.75087 6.20485 2.65033C5.96217 2.54979 5.70206 2.49805 5.43938 2.49805C5.17669 2.49805 4.91658 2.54979 4.6739 2.65033C4.43122 2.75087 4.21072 2.89823 4.025 3.08399C3.98105 3.12778 3.94584 3.17954 3.92125 3.23649L1.32188 9.15024C1.2658 9.26059 1.21675 9.37435 1.175 9.49087C1.02781 9.90271 0.97245 10.3417 1.01279 10.7772C1.05313 11.2127 1.1882 11.6341 1.40853 12.0119C1.62886 12.3897 1.92913 12.7147 2.2883 12.9643C2.64747 13.2138 3.05686 13.3818 3.48778 13.4565C3.91871 13.5311 4.36075 13.5107 4.78294 13.3965C5.20513 13.2824 5.59726 13.0773 5.93186 12.7957C6.26646 12.5141 6.53543 12.1627 6.71994 11.7662C6.90446 11.3697 7.00004 10.9376 7 10.5002V6.00024H9V10.5002C8.99978 10.9376 9.09521 11.3698 9.2796 11.7664C9.46398 12.1631 9.73288 12.5146 10.0674 12.7964C10.402 13.0781 10.7941 13.2833 11.2163 13.3976C11.6385 13.5119 12.0806 13.5324 12.5116 13.4578C12.9426 13.3832 13.3521 13.2153 13.7113 12.9658C14.0706 12.7163 14.3709 12.3912 14.5913 12.0134C14.8117 11.6356 14.9468 11.2142 14.9872 10.7786C15.0276 10.3431 14.9722 9.904 14.825 9.49212ZM4.79438 3.73462C4.96108 3.59426 5.16906 3.51219 5.38669 3.50091C5.60432 3.48963 5.81968 3.54975 6 3.67212V8.26649C5.60963 7.91596 5.13399 7.67418 4.62074 7.56536C4.10749 7.45655 3.57466 7.48453 3.07563 7.64649L4.79438 3.73462ZM4 12.5002C3.60444 12.5002 3.21776 12.3829 2.88886 12.1632C2.55996 11.9434 2.30362 11.6311 2.15224 11.2656C2.00087 10.9002 1.96126 10.498 2.03843 10.1101C2.1156 9.7221 2.30608 9.36574 2.58579 9.08603C2.86549 8.80633 3.22186 8.61584 3.60982 8.53867C3.99778 8.4615 4.39991 8.50111 4.76537 8.65249C5.13082 8.80386 5.44318 9.06021 5.66294 9.3891C5.8827 9.718 6 10.1047 6 10.5002C6 11.0307 5.78929 11.5394 5.41421 11.9145C5.03914 12.2895 4.53043 12.5002 4 12.5002ZM10 3.67149C10.1803 3.54912 10.3957 3.48901 10.6133 3.50029C10.8309 3.51157 11.0389 3.59363 11.2056 3.73399L12.9244 7.64524C12.4253 7.48336 11.8924 7.45548 11.3792 7.56441C10.8659 7.67333 10.3903 7.91523 10 8.26587V3.67149ZM12 12.5002C11.6044 12.5002 11.2178 12.3829 10.8889 12.1632C10.56 11.9434 10.3036 11.6311 10.1522 11.2656C10.0009 10.9002 9.96126 10.498 10.0384 10.1101C10.1156 9.7221 10.3061 9.36574 10.5858 9.08603C10.8655 8.80633 11.2219 8.61584 11.6098 8.53867C11.9978 8.4615 12.3999 8.50111 12.7654 8.65249C13.1308 8.80386 13.4432 9.06021 13.6629 9.3891C13.8827 9.718 14 10.1047 14 10.5002C14 11.0307 13.7893 11.5394 13.4142 11.9145C13.0391 12.2895 12.5304 12.5002 12 12.5002Z",fill:"url(#paint0_linear_2517_15882)"})),m.createElement("defs",null,m.createElement("linearGradient",{id:"paint0_linear_2517_15882",x1:1,y1:13.5018,x2:15.5451,y2:12.7266,gradientUnits:"userSpaceOnUse"},m.createElement("stop",{stopColor:"#F7C3A1"}),m.createElement("stop",{offset:1,stopColor:"#DF9BE8"}))));function Z(e,s,c){var t,n;typeof e=="function"?(t=s||[],n=c):(t=[],n=s);var l=h.useRef({hasResult:!1,result:n,error:null}),a=h.useReducer(function(i){return i+1},0);a[0];var o=a[1],f=h.useMemo(function(){var i=typeof e=="function"?e():e;if(!i||typeof i.subscribe!="function")throw e===i?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!l.current.hasResult&&typeof window<"u"&&(typeof i.hasValue!="function"||i.hasValue()))if(typeof i.getValue=="function")l.current.result=i.getValue(),l.current.hasResult=!0;else{var d=i.subscribe(function(u){l.current.result=u,l.current.hasResult=!0});typeof d=="function"?d():d.unsubscribe()}return i},t);if(h.useDebugValue(l.current.result),h.useEffect(function(){var i=f.subscribe(function(d){var u=l.current;(u.error!==null||u.result!==d)&&(u.error=null,u.result=d,u.hasResult=!0,o())},function(d){var u=l.current;u.error!==d&&(u.error=d,o())});return typeof i=="function"?i:i.unsubscribe.bind(i)},t),l.current.error)throw l.current.error;return l.current.result}function z(e,s,c){return Z(function(){return E(e)},[],c)}const v=M(),Q=({gatewayAddress:e,setSelectedAssessment:s})=>{const c=b(o=>o.networkPortalDB),t=z(async()=>c.observations.where("gatewayAddress").equals(e).toArray()),[n,l]=m.useState([]);m.useEffect(()=>{if(t){const o=t.map(f=>{const i=f.assessment,d=Object.keys(i.arnsAssessments.chosenNames).join(", ");return{timestamp:new Date(f.timestamp),arnsNames:d,ownershipResult:i.ownershipAssessment.pass,arnsResult:i.arnsAssessments.pass,overallResult:i.pass,assessment:i}});l(o)}},[t]);const a=[v.accessor("timestamp",{id:"timestamp",header:"Timestamp",sortDescFirst:!0,cell:({row:o})=>S(new Date(o.original.timestamp))}),v.accessor("arnsNames",{id:"arnsNames",header:"ArNS Names",sortDescFirst:!1}),v.accessor("ownershipResult",{id:"ownershipResult",header:"Ownership Result",sortDescFirst:!1,cell:({row:o})=>r.jsx(x,{value:o.original.ownershipResult})}),v.accessor("arnsResult",{id:"arnsResult",header:"ArNS Result",sortDescFirst:!1,cell:({row:o})=>r.jsx(x,{value:o.original.arnsResult})}),v.accessor("overallResult",{id:"overallResult",header:"Overall Result",sortDescFirst:!1,cell:({row:o})=>r.jsx(x,{value:o.original.overallResult})})];return r.jsxs("div",{children:[r.jsxs("div",{className:"flex w-full items-center rounded-t-xl border border-grey-600 bg-containerL3 py-[0.9375rem] pl-6 pr-[0.8125rem]",children:[r.jsx("div",{className:"grow text-sm text-mid",children:"Reports"}),r.jsx(G,{tableId:"observations",columns:a})]}),r.jsx(W,{columns:a,data:n||[],isLoading:!1,noDataFoundText:"No observations found.",defaultSortingState:{id:"timestamp",desc:!0},onRowClick:o=>{s(o.assessment)},tableId:"observations"})]})},J=["dapp_ardrive","arns"],Y=()=>{const e=b(t=>t.arIOReadSDK),s=b(t=>t.currentEpoch);return I({queryKey:["prescribedNames",e,(s==null?void 0:s.epochIndex)||-1],queryFn:()=>{if(e&&s)return e.getPrescribedNames(s).catch(t=>(console.error("Failed to fetch prescribed names",{message:t.message}),J));throw new Error("arIOReadSDK or currentEpoch not available")},enabled:!!e&&!!s,staleTime:1/0})},N=T.create({timeout:5e3,headers:{"Accept-Encoding":"identity"},throwHttpErrors:!1,cache:"no-store"}),X=async e=>{try{const s=await N.get(`${e.settings.protocol}://${e.settings.fqdn}:${e.settings.port}/ar-io/info`);if(s.status!==200)return{expectedWallets:[e.gatewayAddress],observedWallet:"",pass:!1};const c=await s.json(),t=e.gatewayAddress,n=c.wallet;return{expectedWallets:[t],observedWallet:n,pass:t===n}}catch{return{expectedWallets:[e.gatewayAddress],observedWallet:"",pass:!1}}},D=async e=>{try{const s=await N.get(e);if(s.status===404)return{statusCode:404,resolvedId:"",ttlSeconds:"",contentType:"",contentLength:"",dataHashDigest:""};if(s.status!==200)throw new Error("Unable to fetch ARNS data");const c=await s.arrayBuffer(),t=await crypto.subtle.digest("SHA-256",c),n=H(t);return{statusCode:s.status,resolvedId:s.headers.get("x-arns-resolved-id"),ttlSeconds:s.headers.get("x-arns-ttl-seconds"),contentType:s.headers.get("content-type"),contentLength:s.headers.get("content-length"),dataHashDigest:n}}catch(s){if(s instanceof L)return{statusCode:void 0,resolvedId:"",ttlSeconds:"",contentType:"",contentLength:"",dataHashDigest:"",failureReason:"Timeout awaiting response for 5000ms"};R.error(s);return}},j=async(e,s)=>{const c=`https://${s}.${P}:443`,t=`${e.settings.protocol}://${s}.${e.settings.fqdn}:${e.settings.port}`,n=await D(c),l=Date.now(),a=await D(t),o=Date.now();if(!n)throw new Error("Unable to fetch reference ARNS data");const f={assesedAt:Date.now(),expectedDataHash:n.dataHashDigest,expectedId:n.resolvedId??"",expectedStatusCode:n.statusCode,pass:n.resolvedId===(a==null?void 0:a.resolvedId)&&n.resolvedId!==null&&n.dataHashDigest==(a==null?void 0:a.dataHashDigest)&&n.statusCode==(a==null?void 0:a.statusCode),resolvedDataHash:(a==null?void 0:a.dataHashDigest)??"",resolvedId:(a==null?void 0:a.resolvedId)??"",resolvedStatusCode:(a==null?void 0:a.statusCode)??0,timings:{total:o-l,dns:void 0,download:void 0,firstByte:void 0,request:void 0,tcp:void 0,tls:void 0,wait:void 0}};return[s,f]},ee=async(e,s,c)=>{const t=await X(e),n=await Promise.all(c.map(d=>j(e,d))),l=await Promise.all(s.map(d=>j(e,d))),a=s.length+c.length,f=[...n,...l].reduce((d,u)=>u[1].pass?d+1:d,0)>=a*O;return{arnsAssessments:{chosenNames:Object.fromEntries(n),pass:f,prescribedNames:Object.fromEntries(l)},ownershipAssessment:t,pass:f&&t.pass}},se=e=>e.length>0&&e.split(",").every(s=>s.trim().length>0),te=({gateway:e,setSelectedAssessment:s})=>{const c=A(),t=c==null?void 0:c.ownerId,n=b(p=>p.networkPortalDB),[l,a]=m.useState(!1),{data:o,isLoading:f}=Y(),[i,d]=m.useState((o==null?void 0:o.join(", "))??""),u=async()=>{a(!0);try{const p=await ee({...e,gatewayAddress:t},[],i.split(",").reduce((C,w)=>w.trim().length>0?[...C,w.trim()]:C,[]));R.debug(p),s(p),await n.observations.add({gatewayAddress:t,timestamp:Date.now(),assessment:p})}catch(p){q(`${p}`)}finally{a(!1)}};return m.useEffect(()=>{d((o==null?void 0:o.join(", "))??"")},[o]),r.jsxs("header",{className:"mt-6 flex-col text-clip rounded-xl border leading-[1.4] dark:border-transparent-100-8 dark:bg-grey-1000 dark:text-grey-300",children:[r.jsxs("div",{className:"flex items-center gap-3 py-5 pl-6 pr-4 text-sm",children:[r.jsx("div",{className:"text-mid",children:r.jsx(g,{to:"/gateways",children:"Gateways"})}),r.jsx(y,{className:"size-4 text-mid",strokeWidth:1.5}),e?r.jsx(g,{className:"text-mid",to:`/gateways/${t}`,children:e.settings.label}):r.jsx(B,{}),r.jsx(y,{className:"size-4 text-mid",strokeWidth:1.5}),r.jsx(g,{className:"text-mid",to:`/gateways/${t}/reports`,children:"Observe"}),r.jsx("div",{className:"grow"}),r.jsx("div",{className:"items-center",children:r.jsx(_,{})})]}),r.jsxs("div",{className:"flex items-center gap-3 rounded-b-xl bg-grey-900 px-6 py-5",children:[r.jsx(k,{className:"size-4"}),r.jsx("div",{className:"text-high",children:"Observe"}),r.jsx("div",{className:"grow"}),r.jsx("div",{className:"text-xs text-high",children:"ArNS names:"}),r.jsx("input",{className:"h-7 w-[12.5rem] rounded-md border border-grey-700 bg-grey-1000 p-3 text-sm text-mid outline-none placeholder:text-grey-400 focus:text-high",type:"text",disabled:!e||f,readOnly:!e||f,value:i,onChange:p=>{d(p.target.value)}}),r.jsx("div",{className:e&&se(i)&&!l?void 0:"pointer-events-none opacity-30",children:r.jsx(V,{title:"Run Observation",buttonType:$.PRIMARY,text:"Run Observation",icon:r.jsx(K,{className:"size-4"}),onClick:()=>u()})})]})]})},le=()=>{const e=A(),s=e==null?void 0:e.ownerId,{isLoading:c,data:t}=F({ownerWalletAddress:s}),[n,l]=m.useState();return r.jsxs("div",{className:"flex max-w-full flex-col gap-6 overflow-auto",children:[r.jsx(te,{gateway:t,setSelectedAssessment:l}),c?void 0:t&&s?r.jsx(Q,{gatewayAddress:s,setSelectedAssessment:l}):r.jsxs("div",{children:["Unable to gateway with ID ",s,"."]}),n&&t&&r.jsx(U,{observedHost:t.settings.fqdn,assessment:n,onClose:()=>l(void 0)})]})};export{le as default};
//# sourceMappingURL=index-Clulr7h4.js.map
