import{r as t,a as A,u as de,s as ce,m as _,j as e,d as me,T as $,e as M,D as xe,F as ge,G as q,g as Z,y as U,z,C as ue,q as he,B as pe,x as Ce,E as Ae,Q as se,a7 as _e,N as De,R as Ie,U as Me,W as Re,a6 as Oe,V as Te,t as Fe,a8 as Le,a9 as We,i as Be,aa as Pe,Y as Ge,ab as $e,ac as Ue,ad as ze,ae as Ye,af as Ve,ag as He,ah as qe,P as fe,b as Ze,H as Ke}from"./index-DQHvdTxE.js";import{u as K}from"./useDelegateStakes-D3q4ooBY.js";import{A as we}from"./AddressCell-B1rVsCfI.js";import{C as ye}from"./ColumnSelector-BE6fw_Y1.js";import{S as re,a as Qe}from"./ServerSortableTableView-BKj2xuUh.js";import{S as le}from"./caret_double_right-Cfix3Ety.js";import{g as ve,M as je,S as be,a as Xe,V as ne,C as ie,b as oe,d as Je,W as et,f as tt,I as at,e as st}from"./StakingModal-DuCG6htN.js";import{u as rt}from"./useAllGateways-YBCzRRSm.js";import{S as lt}from"./search-B5ZvmDow.js";import{c as Se,u as nt,R as it,T as ot,C as dt,I as P}from"./TableSkeletonRow-zrttk92L.js";import{T as ct}from"./TableView-BlLijkS0.js";import{L as G,S as mt}from"./LabelValueRow-fN_Xz0zR.js";import{S as xt}from"./observers_connect_icon-CTU2mtDL.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x=new Error().stack;x&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[x]="198eec19-0801-4487-f993-f71d2334edcd",r._sentryDebugIdIdentifier="sentry-dbid-198eec19-0801-4487-f993-f71d2334edcd")}catch{}})();const gt=r=>t.createElement("svg",{width:1440,height:941,viewBox:"40 0 1440 941",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},t.createElement("g",{filter:"url(#filter0_ddddd_2683_6709)"},t.createElement("g",{clipPath:"url(#clip0_2683_6709)"},t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M790 735L790 -89H789L789 735H790ZM774 735L774 106H773L773 735H774ZM742 735L742 182H741L741 735H742ZM726 -13L726 735H725L725 -13H726ZM710 735L710 290H709L709 735H710Z",fill:"url(#paint1_linear_2683_6709)",fillOpacity:.25}),t.createElement("line",{x1:789.5,y1:735,x2:789.5,y2:-37,stroke:"url(#paint2_linear_2683_6709)"}),t.createElement("path",{opacity:.8,d:"M757.499 735L755.564 95.9288",stroke:"url(#paint3_linear_2683_6709)"}),t.createElement("line",{opacity:.1,x1:725.5,y1:735,x2:725.5,y2:56,stroke:"url(#paint4_linear_2683_6709)"}),t.createElement("line",{opacity:.2,x1:805.5,y1:735,x2:805.5,y2:141,stroke:"url(#paint5_linear_2683_6709)"}),t.createElement("line",{opacity:.5,x1:741.5,y1:735,x2:741.5,y2:182,stroke:"url(#paint6_linear_2683_6709)"}),t.createElement("line",{opacity:.4,x1:773.5,y1:735,x2:773.5,y2:106,stroke:"url(#paint7_linear_2683_6709)"}),t.createElement("line",{opacity:.8,x1:709.5,y1:735,x2:715.938,y2:162,stroke:"url(#paint8_linear_2683_6709)"}),t.createElement("ellipse",{cx:753,cy:147,rx:135.721,ry:47.833,fill:"url(#paint9_radial_2683_6709)"})),t.createElement("rect",{x:90.5,y:83.5,width:1325,height:133,rx:11.5,stroke:"url(#paint10_linear_2683_6709)"})),t.createElement("defs",null,t.createElement("filter",{id:"filter0_ddddd_2683_6709",x:-393,y:0,width:2292,height:2426,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},t.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:69}),t.createElement("feGaussianBlur",{stdDeviation:76}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.29 0"}),t.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_2683_6709"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:276}),t.createElement("feGaussianBlur",{stdDeviation:138}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.26 0"}),t.createElement("feBlend",{mode:"normal",in2:"effect1_dropShadow_2683_6709",result:"effect2_dropShadow_2683_6709"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:621}),t.createElement("feGaussianBlur",{stdDeviation:186.5}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0"}),t.createElement("feBlend",{mode:"normal",in2:"effect2_dropShadow_2683_6709",result:"effect3_dropShadow_2683_6709"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:1105}),t.createElement("feGaussianBlur",{stdDeviation:221}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.04 0"}),t.createElement("feBlend",{mode:"normal",in2:"effect3_dropShadow_2683_6709",result:"effect4_dropShadow_2683_6709"}),t.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),t.createElement("feOffset",{dy:1726}),t.createElement("feGaussianBlur",{stdDeviation:241.5}),t.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.01 0"}),t.createElement("feBlend",{mode:"normal",in2:"effect4_dropShadow_2683_6709",result:"effect5_dropShadow_2683_6709"}),t.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect5_dropShadow_2683_6709",result:"shape"})),t.createElement("linearGradient",{id:"paint0_linear_2683_6709",x1:539,y1:83,x2:998.042,y2:318.345,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#1D1D1F"}),t.createElement("stop",{offset:1,stopColor:"#0E0E0F"})),t.createElement("linearGradient",{id:"paint1_linear_2683_6709",x1:715.408,y1:561.527,x2:790.846,y2:561.346,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint2_linear_2683_6709",x1:790.789,y1:673.924,x2:752.713,y2:671.902,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint3_linear_2683_6709",x1:757.092,y1:684.441,x2:684.303,y2:675.402,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint4_linear_2683_6709",x1:726.789,y1:681.282,x2:688.744,y2:678.984,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint5_linear_2683_6709",x1:806.789,y1:688.006,x2:768.786,y2:685.383,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint6_linear_2683_6709",x1:742.789,y1:691.25,x2:704.814,y2:688.435,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint7_linear_2683_6709",x1:774.789,y1:685.237,x2:736.767,y2:682.759,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("linearGradient",{id:"paint8_linear_2683_6709",x1:715.083,y1:689.668,x2:512.283,y2:596.245,gradientUnits:"userSpaceOnUse"},t.createElement("stop",{stopColor:"#F7C3A1"}),t.createElement("stop",{offset:.52,stopColor:"#EBAEC6"}),t.createElement("stop",{offset:1,stopColor:"#DF9BE8"})),t.createElement("radialGradient",{id:"paint9_radial_2683_6709",cx:0,cy:0,r:1,gradientUnits:"userSpaceOnUse",gradientTransform:"translate(753 147) rotate(90) scale(72.7222 206.342)"},t.createElement("stop",{offset:.25,stopColor:"#19191C",stopOpacity:.9}),t.createElement("stop",{offset:.707422,stopColor:"#19191C",stopOpacity:.25})),t.createElement("clipPath",{id:"clip0_2683_6709"},t.createElement("rect",{x:90,y:83,width:1326,height:134,rx:12,fill:"white"})))),F=Se(),V=25,ke=()=>{var X,J;const r=A(s=>s.walletAddress),x=A(s=>s.ticker),o=de(),[g,m]=t.useState(1),[u,j]=t.useState(""),[l,c]=t.useState(""),[n,E]=t.useState([{id:"totalStake",desc:!0}]);t.useEffect(()=>{const s=setTimeout(()=>{c(u.trim()),m(1)},300);return()=>clearTimeout(s)},[u]);const f={label:"settings.label",domain:"settings.fqdn",owner:"gatewayAddress",totalStake:"totalDelegatedStake"},S=(X=n[0])==null?void 0:X.id,h=(J=n[0])==null?void 0:J.desc,d=S&&f[S]||"totalDelegatedStake",b=h?"desc":"asc",{isLoading:w,isFetching:y,isError:v,data:N}=rt({sortBy:d,sortOrder:b}),{data:R}=ce(),[k,D]=t.useState([]),[T,B]=t.useState(),[a,i]=t.useState(!1),p=t.useMemo(()=>N?N.filter(s=>s.status==="joined"&&s.settings.allowDelegatedStaking):[],[N]);t.useEffect(()=>{if(!p.length||!R){D([]);return}const s=new _(R).toARIO(),O=p.length,Y=p.map(C=>{const ee=C.stats.passedEpochCount,H=C.stats.totalEpochCount,te=new _(C.totalDelegatedStake).toARIO().valueOf(),ae=new _(C.operatorStake).toARIO().valueOf();return{label:C.settings.label,domain:C.settings.fqdn,owner:C.gatewayAddress,streak:C.stats.failedConsecutiveEpochs>0?-C.stats.failedConsecutiveEpochs:C.stats.passedConsecutiveEpochs,rewardShareRatio:C.settings.delegateRewardShareRatio,performance:H>0?ee/H:-1,passedEpochCount:ee,totalEpochCount:H,totalDelegatedStake:te,operatorStake:ae,totalStake:te+ae,eay:ve(s,O,C).EAY}});D(Y)},[p,R]);const I=t.useMemo(()=>{if(!l)return k;const s=l.toLowerCase();return k.filter(O=>O.domain.toLowerCase().includes(s))},[k,l]),W=Math.ceil(I.length/V),Ee=t.useMemo(()=>{const s=(g-1)*V,O=s+V;return I.slice(s,O)},[I,g]),Ne=s=>{E(s),m(1)},Q=t.useMemo(()=>[F.accessor("label",{id:"label",header:"Label",sortDescFirst:!1}),F.accessor("domain",{id:"domain",header:"Domain",sortDescFirst:!1,cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://${s.getValue("domain")}`,target:"_blank",rel:"noreferrer",onClick:O=>{O.stopPropagation()},className:"text-gradient",children:s.getValue("domain")}),e.jsx(me,{textToCopy:s.getValue("domain")})]})}),F.accessor("owner",{id:"owner",header:"Address",sortDescFirst:!1,cell:({row:s})=>e.jsx(we,{address:s.getValue("owner")})}),F.accessor("totalStake",{id:"totalStake",header:`Total Stake (${x})`,sortDescFirst:!0,cell:({row:s})=>e.jsx($,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["Operator Stake: ",M(s.original.operatorStake)," ",x]}),e.jsxs("div",{className:"mt-1",children:["Delegated Stake:"," ",M(s.original.totalDelegatedStake)," ",x]})]}),children:M(s.getValue("totalStake"))})}),F.accessor("rewardShareRatio",{id:"rewardShareRatio",header:"Reward Share Ratio",enableSorting:!1,cell:({row:s})=>s.original.rewardShareRatio>=0?`${s.original.rewardShareRatio}%`:"N/A"}),F.accessor("eay",{id:"eay",meta:{displayName:"Delegate EAY"},header:()=>e.jsxs("div",{className:"flex gap-1",children:["Delegate EAY",e.jsx($,{message:e.jsxs("div",{children:[e.jsx("p",{children:xe}),e.jsx(je,{className:"mt-4",children:ge})]}),children:e.jsx(q,{className:"h-full"})})]}),enableSorting:!1,cell:({row:s})=>e.jsx("div",{children:s.original.eay<0?"N/A":`${M(s.original.eay*100)}%`})}),F.accessor("performance",{id:"performance",header:"Performance",enableSorting:!1,cell:({row:s})=>s.original.performance<0?"N/A":e.jsx($,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["Passed Epoch Count: ",s.original.passedEpochCount]}),e.jsxs("div",{className:"mt-1",children:["Total Epoch Participation Count:"," ",s.original.totalEpochCount]})]}),children:`${(s.original.performance*100).toFixed(2)}%`})}),F.accessor("streak",{id:"streak",header:"Streak",enableSorting:!1,cell:({row:s})=>e.jsx(Z,{streak:s.original.streak})}),F.display({id:"action",header:"",cell:({row:s})=>{const O=s.original.owner===(r==null?void 0:r.toString()),Y=e.jsx(U,{buttonType:z.PRIMARY,active:!0,title:"Manage Stake",text:"Stake",onClick:C=>{C.stopPropagation(),r?O||B(s.getValue("owner")):i(!0)}});return e.jsx("div",{className:"pr-6",children:O?e.jsx($,{message:"Delegate staking is not supported for gateways you operate. Please use operator staking on your gateway details page.",children:e.jsx("div",{className:"pointer-events-none opacity-30",children:Y})}):Y})}})],[x,r,B,i]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex w-full items-center overflow-x-auto justify-between rounded-t-xl border border-grey-600 bg-containerL3 py-2 pl-6 pr-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-mid",children:["Delegate Stake"," ",!w&&`(${M(I.length)}${l?` of ${M(k.length)}`:""})`]}),e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-low"}),e.jsx("input",{type:"text",placeholder:"Search domain...",value:u,onChange:s=>j(s.target.value),className:"w-[400px] rounded-md border border-grey-700 bg-grey-1000 py-1.5 pl-9 pr-3 text-sm text-mid outline-none placeholder:text-grey-400 focus:text-high"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[W>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(1),disabled:g===1,className:"rounded-md bg-containerL2 p-1 text-mid transition-all hover:bg-containerL1 disabled:opacity-50","aria-label":"First page",children:e.jsx(le,{className:"h-4 w-4 rotate-180"})}),e.jsx("button",{onClick:()=>m(Math.max(1,g-1)),disabled:g===1,className:"rounded-md bg-containerL2 p-1 text-mid transition-all hover:bg-containerL1 disabled:opacity-50","aria-label":"Previous page",children:e.jsx(re,{className:"h-4 w-4 rotate-180"})}),e.jsxs("span",{className:"text-xs text-mid",children:["Page ",g," of ",W]}),e.jsx("button",{onClick:()=>m(Math.min(W,g+1)),disabled:g===W,className:"rounded-md bg-containerL2 p-1 text-mid transition-all hover:bg-containerL1 disabled:opacity-50","aria-label":"Next page",children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m(W),disabled:g===W,className:"rounded-md bg-containerL2 p-1 text-mid transition-all hover:bg-containerL1 disabled:opacity-50","aria-label":"Last page",children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsx(ye,{tableId:"delegate-stake",columns:Q})]})]}),e.jsx(Qe,{columns:Q,data:Ee,defaultSortingState:{id:"totalStake",desc:!0},currentSorting:n,onSortingChange:Ne,isLoading:w,isFetching:y,isError:v,noDataFoundText:"No gateways with delegate staking enabled found.",errorText:"Unable to load delegate stakes.",loadingRows:V,onRowClick:s=>{o(`/gateways/${s.owner}`)},tableId:"delegate-stake"}),T&&e.jsx(be,{open:!!T,onClose:()=>B(void 0),ownerWallet:T}),a&&e.jsx(ue,{onClose:()=>i(!1)})]})},ut=({onClose:r,ownerWallet:x})=>{const o=A(p=>p.walletAddress),{data:g}=he(o),m=A(p=>p.ticker),[u,j]=t.useState(0),[l,c]=t.useState(""),[n,E]=t.useState("standard"),[f,S]=t.useState(!1),{data:h}=nt({ownerWalletAddress:x}),{data:d}=K(o==null?void 0:o.toString());t.useEffect(()=>{var I;if(!h||!d)return;const p=(I=d.stakes.find(W=>W.gatewayAddress===h.gatewayAddress))==null?void 0:I.balance;j(new _(p??0).toARIO().valueOf())},[d,h]);const b=(h==null?void 0:h.settings.allowDelegatedStaking)??!1,w=h?new _(h==null?void 0:h.settings.minDelegatedStake).toARIO().valueOf():10,y=u>0?1:w,v=n==="expedited"?.5*parseFloat(l):0,N=isNaN(parseFloat(l))?"-":+(isNaN(v)?parseFloat(l):parseFloat(l)-v).toFixed(4),R={withdrawAmount:_e("Withdraw Amount",m,u,w)},k=()=>h?R.withdrawAmount(l)===void 0:!1,D=parseFloat(l.length===0?"0":l),T=u-D,B=()=>{c(u+"")},a=!h||u<=0,i={withdrawAmount:R.withdrawAmount(l),cannotStake:((g==null?void 0:g.ario)||0)<y?`Insufficient balance, at least ${y} IO required.`:b?void 0:"Gateway does not allow delegated staking."};return e.jsx(pe,{onClose:r,useDefaultPadding:!1,children:e.jsxs("div",{className:"w-[calc(100vw-2rem)] lg:w-[28.5rem]",children:[e.jsx("div",{className:"border-b border-b-stroke-low",children:e.jsx("div",{className:"rounded-tr-xl border-b border-red-400 bg-grey-700 py-3 text-center",children:e.jsx("span",{className:"text-gradient",children:"Withdraw"})})}),e.jsxs("div",{className:"flex flex-col p-8 pb-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(G,{label:"Gateway Owner:",value:Ce(x)}),e.jsx(G,{label:"Label:",value:h?h.settings.label:"-"}),e.jsx(G,{label:"Domain:",isLink:!0,value:h?h.settings.fqdn:"-"})]}),e.jsxs("div",{className:"mt-8 flex items-center",children:[e.jsx("div",{className:"text-left text-sm text-mid",children:"Amount:"}),e.jsx("div",{className:"grow"}),e.jsx("div",{className:"text-left text-xs text-low",children:`Available to Withdraw: ${T>=0?M(T):"-"} ${m}`})]}),e.jsxs("div",{className:"mt-3 flex h-[3.25rem] items-center overflow-hidden rounded-md border border-grey-800",children:[e.jsx("input",{className:"size-full grow  bg-grey-1000 px-6 py-3 text-sm text-mid outline-none placeholder:text-grey-400 focus:text-high",disabled:a,readOnly:a,type:"text",placeholder:`Enter amount of ${m} to withdraw`,value:l,onChange:p=>{const I=p.target.value;I&&isNaN(+p.target.value)||c(I)}}),(l==null?void 0:l.length)>0&&i.withdrawAmount&&e.jsx(Ae,{errorMessage:i.withdrawAmount,tooltipPadding:"3"}),e.jsx(U,{className:"mr-3 h-7",onClick:a?void 0:B,buttonType:z.SECONDARY,active:!0,title:"Max",text:"Max"})]}),e.jsx("div",{className:"mt-4 flex flex-col gap-2",children:e.jsxs(Xe,{className:"my-2 flex flex-col gap-4 text-sm",value:n,onChange:p=>E(p),children:[e.jsx(ne,{value:"standard",className:`group flex w-full cursor-pointer rounded 
                  from-gradient-primary-start to-gradient-primary-end data-[checked]:bg-gradient-to-r`,children:e.jsxs("div",{className:"m-px flex size-full flex-col gap-1 rounded  bg-containerL3 px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"visible size-4 group-data-[checked]:hidden"}),e.jsx(oe,{className:"hidden size-4 group-data-[checked]:block"}),e.jsx(se,{children:"Standard Withdrawal"})]}),e.jsx("p",{className:"pl-6 text-left text-xs text-mid",children:"90 day withdrawal period with no fees."})]})}),e.jsx(ne,{value:"expedited",className:`group flex w-full cursor-pointer rounded 
                  from-gradient-primary-start to-gradient-primary-end data-[checked]:bg-gradient-to-r`,children:e.jsxs("div",{className:"m-px flex size-full flex-col gap-1 rounded  bg-containerL3 px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"visible size-4 group-data-[checked]:hidden"}),e.jsx(oe,{className:"hidden size-4 group-data-[checked]:block"}),e.jsx(se,{children:"Expedited Withdrawal"})]}),e.jsx("p",{className:"pl-6 text-left text-xs text-mid",children:"Instant withdrawal with 50% fee."})]})})]})})]}),e.jsxs("div",{className:"flex size-full flex-col gap-2 bg-containerL0 px-8 pb-8 pt-4",children:[n==="expedited"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"first:text-mid last:text-mid",label:"Fee:",value:`${isNaN(v)?"-":+v.toFixed(4)} ${m}`}),e.jsx(G,{className:"first:text-mid last:text-mid",label:"Returning Amount:",value:`${N} ${m}`})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(G,{label:"New Total Stake:",value:`${k()?M(u-parseFloat(l)):"-"} ${m}`})}),e.jsx("div",{className:k()?void 0:"pointer-events-none opacity-30",children:e.jsx(U,{className:"mt-4 h-[3.25rem] w-full",onClick:()=>{S(!0)},buttonType:z.PRIMARY,title:"Review",text:"Review"})})]}),f&&h&&o&&e.jsx(Je,{amountToWithdraw:parseFloat(l),withdrawalType:n,gateway:h,onClose:()=>S(!1),onSuccess:()=>r(),ticker:m,walletAddress:o,withdrawalFee:v,returningAmount:N})]})})},ht=({onClose:r,activeStakes:x})=>{const o=De(),[g,m]=t.useState(!1),[u,j]=t.useState(!1),l=A(d=>d.walletAddress),c=A(d=>d.arIOWriteableSDK),n=A(d=>d.ticker),f=x.sort((d,b)=>b.delegatedStake-d.delegatedStake).filter(d=>d.delegatedStake>0),S=x.reduce((d,b)=>d+b.delegatedStake,0),h=async()=>{if(l&&c){m(!0);try{for(const d of f)if(d.delegatedStake>0){const{id:b}=await c.decreaseDelegateStake({target:d.owner,decreaseQty:d.delegatedStake},Re);Oe.info(`Decrease Delegate Stake txID: ${b}`)}o.invalidateQueries({queryKey:["gateway",l.toString()],refetchType:"all"}),o.invalidateQueries({queryKey:["gateways"],refetchType:"all"}),o.invalidateQueries({queryKey:["delegateStakes"],refetchType:"all"}),j(!0)}catch(d){Te(`${d}`)}finally{m(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{onClose:r,useDefaultPadding:!1,children:e.jsxs("div",{className:"w-[calc(100vw-2rem)] text-left lg:w-[28.4375rem]",children:[e.jsxs("div",{className:"px-8  pb-4 pt-6",children:[e.jsx("div",{className:"text-lg text-high",children:"Withdraw All"}),e.jsx("div",{className:"flex pt-2 text-xs text-low",children:"Withdraw all delegated stakes."})]}),e.jsxs("div",{className:"border-y border-grey-800 p-8",children:[e.jsx("table",{className:"mb-8 w-full table-auto",children:f.map((d,b)=>e.jsxs("tr",{className:"text-sm",children:[e.jsx("td",{className:"py-2 text-low ",children:d.gateway.settings.label}),e.jsx("td",{className:"py-2",children:e.jsx("a",{className:"text-gradient",href:`https://${d.gateway.settings.fqdn}`,target:"_blank",rel:"noreferrer",children:d.gateway.settings.fqdn})}),e.jsxs("td",{className:"py-2 text-right text-mid ",children:[new _(d.delegatedStake).toARIO().valueOf()," ",n]})]},b))}),e.jsx(et,{})]}),e.jsxs("div",{className:"bg-containerL0 px-8 pb-8 pt-6",children:[e.jsxs("div",{className:"mt-1 flex text-sm text-mid",children:[e.jsx("div",{className:"grow",children:"Total Withdrawal:"}),e.jsxs("div",{children:[new _(S).toARIO().valueOf()," ",n]})]}),e.jsx("div",{className:"mt-6 flex grow justify-center",children:e.jsx(U,{onClick:h,buttonType:z.PRIMARY,title:"Withdraw",text:e.jsx("div",{className:"py-2",children:"Withdraw"}),className:"w-full"})})]})]})}),g&&e.jsx(Ie,{onClose:()=>m(!1),message:"Sign the following data with your wallet to proceed."}),u&&e.jsx(Me,{onClose:()=>{j(!1),r()},title:"Congratulations",bodyText:"You have successfully withdrawn all stakes."})]})},L=Se(),pt=()=>{const r=A(a=>a.walletAddress),x=A(a=>a.ticker),{isFetching:o,isError:g,data:m}=Fe(),[u,j]=t.useState(),[l,c]=t.useState(!1),[n,E]=t.useState(),[f,S]=t.useState(),[h,d]=t.useState(),[b,w]=t.useState(),[y,v]=t.useState(),N=de(),{isError:R,data:k}=K(r==null?void 0:r.toString()),{data:D}=ce();t.useEffect(()=>{const a=o?void 0:!k||!m||!D?[]:[...k.stakes.filter(i=>i.balance>0).map(i=>{const p=m[i.gatewayAddress];return{owner:i.gatewayAddress,gateway:{...p,gatewayAddress:i.gatewayAddress},amount:i.balance,status:"Active",streak:p.status==="leaving"?Number.NEGATIVE_INFINITY:p.stats.failedConsecutiveEpochs>0?-p.stats.failedConsecutiveEpochs:p.stats.passedConsecutiveEpochs,eay:ve(new _(D).toARIO(),Object.values(m).filter(I=>I.status==="joined").length,p).EAY}}),...k.withdrawals.map(i=>{const p=m[i.gatewayAddress];return{owner:i.gatewayAddress,gateway:{...p,gatewayAddress:i.gatewayAddress},amount:i.balance,status:"Withdrawing",withdrawalDate:new Date(i.endTimestamp),withdrawalId:i.vaultId,withdrawal:i}})];j(a)},[k,m,o,D]);const T=t.useMemo(()=>[L.accessor("status",{id:"status",header:"Status",sortDescFirst:!1,cell:({row:a})=>e.jsx("div",{className:a.original.status==="Active"?"text-primary":"text-warning",children:a.original.status})}),L.accessor("gateway.settings.label",{id:"label",header:"Label",sortDescFirst:!1}),L.accessor("gateway.settings.fqdn",{id:"domain",header:"Domain",sortDescFirst:!1,cell:({row:a})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://${a.getValue("domain")}`,target:"_blank",rel:"noreferrer",onClick:i=>{i.stopPropagation()},className:"text-gradient",children:a.getValue("domain")}),e.jsx(me,{textToCopy:a.getValue("domain")})]})}),L.accessor("owner",{id:"owner",header:"Address",sortDescFirst:!1,cell:({row:a})=>e.jsx(we,{address:a.getValue("owner")})}),L.accessor("amount",{id:"amount",header:`Amount (${x})`,sortDescFirst:!0,cell:({row:a})=>`${new _(a.original.amount).toARIO().valueOf()}`}),L.accessor("eay",{id:"eay",meta:{displayName:"Delegate EAY"},header:()=>e.jsxs("div",{className:"flex gap-1",children:["Delegate EAY",e.jsx($,{message:e.jsxs("div",{children:[e.jsx("p",{children:xe}),e.jsx(je,{className:"mt-4",children:ge})]}),children:e.jsx(q,{className:"h-full"})})]}),sortDescFirst:!0,cell:({row:a})=>e.jsx("div",{children:a.original.status==="Withdrawing"||!a.original.eay||a.original.eay<0?"N/A":`${M(a.original.eay*100)}%`})}),L.accessor("streak",{id:"streak",header:"Streak",sortDescFirst:!0,cell:({row:a})=>a.original.status==="Withdrawing"?e.jsx("span",{className:"text-low",children:"N/A"}):e.jsx(Z,{streak:a.original.streak})}),L.accessor("withdrawalDate",{id:"withdrawalDate",header:"Withdrawal Date",sortDescFirst:!0,cell:({row:a})=>e.jsx("div",{className:a.original.withdrawalDate?"text-high":"text-low",children:a.original.withdrawalDate?Le(a.original.withdrawalDate).format("YYYY-MM-DD"):"N/A"})}),L.display({id:"action",header:"",cell:({row:a})=>e.jsx("div",{className:"flex w-full justify-end pr-6",children:e.jsxs(it,{modal:!1,children:[e.jsx(ot,{asChild:!0,onClick:i=>i.stopPropagation(),children:e.jsx("div",{className:"cursor-pointer rounded-md bg-gradient-to-b from-btn-primary-outer-gradient-start to-btn-primary-outer-gradient-end  p-px",children:e.jsx("div",{className:"inline-flex size-full items-center justify-start gap-[0.6875rem] rounded-md bg-btn-primary-base bg-gradient-to-b from-btn-primary-gradient-start to-btn-primary-gradient-end px-[0.3125rem] py-[.3125rem] shadow-inner",children:e.jsx(mt,{className:"size-4"})})})}),e.jsx(dt,{className:"z-50 rounded border border-grey-500 bg-containerL0 text-sm",children:a.original.status==="Active"?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"cursor-pointer select-none px-4 py-2 outline-none data-[highlighted]:bg-containerL3",onClick:i=>{i.stopPropagation(),E(a.original.owner)},children:"Add Stake"}),e.jsx(P,{className:"cursor-pointer select-none px-4 py-2 outline-none data-[highlighted]:bg-containerL3",onClick:i=>{i.stopPropagation(),S(a.original.owner)},children:"Withdraw Stake"}),e.jsx(P,{className:"cursor-pointer select-none px-4 py-2 outline-none data-[highlighted]:bg-containerL3",onClick:i=>{i.stopPropagation(),d({sourceGateway:a.original.gateway,onClose:()=>d(void 0),maxRedelegationStake:new _(a.original.amount).toARIO()})},children:"Redelegate"})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"cursor-pointer select-none px-4 py-2 outline-none data-[highlighted]:bg-containerL3",onClick:i=>{i.stopPropagation(),v({gateway:a.original.gateway,gatewayAddress:a.original.owner,vault:a.original.withdrawal,vaultId:a.original.withdrawalId})},children:"Expedite Withdrawal"}),e.jsx(P,{className:"cursor-pointer select-none px-4 py-2 outline-none data-[highlighted]:bg-containerL3",onClick:i=>{i.stopPropagation(),w({gatewayAddress:a.original.owner,vaultId:a.original.withdrawalId})},children:"Cancel Withdrawal"}),e.jsx(P,{className:"cursor-pointer select-none px-4 py-2 outline-none data-[highlighted]:bg-containerL3",onClick:i=>{i.stopPropagation(),d({sourceGateway:a.original.gateway,onClose:()=>d(void 0),maxRedelegationStake:new _(a.original.amount).toARIO(),vaultId:a.original.withdrawalId})},children:"Redelegate"})]})})]})})})],[x,E,S,d]),B=(u==null?void 0:u.some(a=>a.status==="Active"&&a.amount>0))??!1;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex w-full items-center overflow-x-auto gap-4 rounded-t-xl border border-grey-600 bg-containerL3 pl-6 pr-3 py-2",children:[e.jsx("div",{className:"grow text-sm text-mid",children:"My Stakes"}),e.jsxs("div",{className:"flex items-center gap-3",children:[B&&e.jsx(U,{buttonType:z.SECONDARY,className:"*:text-gradient-red h-[1.875rem]",active:!0,title:"Withdraw All",text:"Withdraw All",onClick:()=>c(!0)}),e.jsx(ye,{tableId:"my-stakes-unified",columns:T})]})]}),e.jsx(ct,{columns:T,data:u||[],isLoading:o||u===void 0,isError:g||R,noDataFoundText:"No stakes found.",errorText:"Unable to load stakes.",loadingRows:10,defaultSortingState:{id:"amount",desc:!0},onRowClick:a=>{N(`/gateways/${a.owner}`)},tableId:"my-stakes-unified"},"unifiedStakesTable"),l&&u!==void 0&&e.jsx(ht,{activeStakes:u.filter(a=>a.status==="Active").map(a=>({owner:a.owner,delegatedStake:a.amount,gateway:a.gateway})),onClose:()=>c(!1)}),n&&e.jsx(be,{open:!!n,onClose:()=>{E(void 0)},ownerWallet:n}),f&&e.jsx(ut,{open:!!f,onClose:()=>{S(void 0)},ownerWallet:f}),b&&e.jsx(tt,{gatewayAddress:b.gatewayAddress,vaultId:b.vaultId,onClose:()=>w(void 0)}),y&&e.jsx(at,{gateway:y.gateway,gatewayAddress:y.gatewayAddress,vaultId:y.vaultId,vault:y.vault,onClose:()=>v(void 0)}),h&&e.jsx(st,{...h})]})},ft=(r,x=7)=>{const{data:o}=We(x),g=A(m=>m.currentEpoch);return Be({queryKey:["rewards",r,x,o==null?void 0:o.length,g==null?void 0:g.epochIndex],queryFn:async()=>{if(!o||!r)return{rewardsData:[],totalRewards:0};const j=[...o.filter(c=>(c==null?void 0:c.epochIndex)!==(g==null?void 0:g.epochIndex))].sort((c,n)=>((c==null?void 0:c.epochIndex)||0)-((n==null?void 0:n.epochIndex)||0)).map(c=>{const n=c==null?void 0:c.distributions,f=(n&&Pe(n)?n.rewards.distributed??{}:{})[r]||0,S=new _(f).toARIO().valueOf().toFixed(1);return{epochIndex:(c==null?void 0:c.epochIndex)||0,rewards:Number(S)}}),l=j.reduce((c,n)=>c+n.rewards,0);return{rewardsData:j,totalRewards:l}},enabled:!!o&&!!r,staleTime:1*60*60*1e3,gcTime:30*60*1e3})},wt=({walletAddress:r})=>{const x=A(w=>w.ticker),{data:o}=Ge(),[g,m]=t.useState(7),[u,j]=t.useState(),{data:l,isLoading:c}=ft(r,g),n=l==null?void 0:l.rewardsData,E=l==null?void 0:l.totalRewards,[f,S]=t.useState(null),h=f?f.rewards:E;t.useEffect(()=>{if(!n||n.length<2){j(void 0);return}if(f){const w=n.findIndex(y=>y.epochIndex===f.epochIndex);if(w>0){const y=f.rewards,v=n[w-1].rewards,N=v>0?(y-v)/v*100:y>0?100:0;j(N)}else j(void 0)}else{const w=n.length-1,y=w-1,v=n.slice(0,w+1).reduce((k,D)=>k+D.rewards,0),N=n.slice(0,y+1).reduce((k,D)=>k+D.rewards,0),R=N>0?(v-N)/N*100:v>0?100:0;j(R)}},[f,n]);const d=(o==null?void 0:o.hasEpochZeroStarted)??!0,b=o==null?void 0:o.epochZeroStartTimestamp;return e.jsxs("div",{className:"relative flex flex-col rounded-xl border border-grey-600 px-6 py-5 h-48 overflow-hidden",children:[!c&&n&&n.length>=2&&e.jsx("div",{className:"absolute inset-0 top-16",children:e.jsx($e,{width:"100%",height:"100%",children:e.jsxs(Ue,{data:n,margin:{top:10,right:0,bottom:0,left:0},onMouseMove:w=>{var y,v;(v=(y=w==null?void 0:w.activePayload)==null?void 0:y[0])!=null&&v.payload?S(w.activePayload[0].payload):S(null)},onMouseLeave:()=>{S(null)},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"stakingRewardsGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#E19EE5",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#E19EE5",stopOpacity:.1})]})}),e.jsx(ze,{dataKey:"epochIndex",axisLine:!1,tickLine:!1,tick:!1,height:0}),e.jsx(Ye,{axisLine:!1,tickLine:!1,tick:!1,width:0,domain:[1,"dataMax"]}),e.jsx(Ve,{content:()=>null,cursor:!1}),e.jsx(He,{type:"monotone",dataKey:"rewards",stroke:"#E19EE5",strokeWidth:2,strokeOpacity:.2,fillOpacity:.2,fill:"url(#stakingRewardsGradient)",dot:!1,activeDot:{r:4,fill:"#E19EE5",stroke:"#ffffff",strokeWidth:2}})]})})}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-mid",children:"Total ARIO Rewards"}),e.jsx(qe,{value:g,onChange:m})]})}),e.jsx("div",{className:"absolute bottom-5 left-6 right-6 z-10 flex flex-col",children:b&&!d?e.jsxs("div",{className:"flex grow items-center justify-center self-center text-center text-sm italic text-low",children:["Staking rewards begin on"," ",new Date(b).toLocaleDateString()]}):e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-xs text-mid mb-1",children:f?`Epoch ${f.epochIndex}`:"Total Earned"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("div",{className:"text-[2.625rem] font-bold text-high leading-none",children:c||h===void 0?e.jsx(fe,{}):M(h)}),e.jsx("div",{className:"text-sm text-high",children:x})]})]}),f&&u!==void 0&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("div",{className:"text-xs text-mid mb-1",children:"vs Previous"}),e.jsx(Z,{streak:u,fixedDigits:2,rightLabel:"%"})]})]})})]})},yt=({title:r,value:x,ticker:o})=>e.jsxs("div",{className:"rounded-xl border border-grey-600 px-6 pb-5 pt-10 text-center h-48 flex flex-col",children:[e.jsx("div",{className:"text-sm text-mid",children:r}),e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("div",{className:"text-[3.5rem] font-bold leading-none text-high",children:x??e.jsx("div",{className:"h-[3.5rem]",children:e.jsx(fe,{className:"m-auto"})})}),e.jsx("div",{className:"text-sm text-high",children:o})]})})]}),vt=()=>{const r=A(l=>l.walletAddress),x=A(l=>l.ticker),[o,g]=t.useState(),{data:m}=he(r),{data:u}=K(r==null?void 0:r.toString());t.useEffect(()=>{if(u){const l=u.stakes.reduce((n,E)=>n+E.balance,0),c=u.withdrawals.reduce((n,E)=>n+E.balance,0);g(new _(l+c).toARIO().valueOf())}},[u]);const j=[{title:"Your Balance",balance:m?M(m.ario):void 0},{title:"Amount Staking + Pending Withdrawals",balance:o!==void 0?M(o):void 0}];return e.jsxs("div",{className:"flex flex-col gap-6 pb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[j.map((l,c)=>e.jsx(yt,{title:l.title,value:l.balance,ticker:x},c)),e.jsx(wt,{walletAddress:r==null?void 0:r.toString()})]}),e.jsx(pt,{}),e.jsx(ke,{})]})},jt=()=>{const[r,x]=t.useState(!1);return e.jsxs("div",{children:[e.jsxs("button",{className:"group relative flex h-[7.5rem] w-full justify-center overflow-hidden rounded-xl bg-grey-800",onClick:()=>{x(!0)},children:[e.jsx(gt,{className:"absolute top-[-5.625rem] h-[58.1875rem] w-[90rem]  opacity-80"}),e.jsx("div",{className:`invisible size-full rounded-xl
       bg-gradient-to-r from-gradient-primary-start to-gradient-primary-end p-px group-hover:visible`,children:e.jsx("div",{className:"size-full overflow-hidden rounded-xl bg-grey-800"})}),e.jsxs("div",{className:"absolute top-0 z-10 flex size-full flex-col items-center justify-center bg-transparent py-6 align-middle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:"size-4"}),e.jsx("div",{className:"text-gradient",children:"Connect your wallet to start staking"})," "]}),e.jsx("div",{className:"pt-2 text-sm text-low",children:"By delegating stake to a gateway, you can participate in the network's reward system."})]})]}),r&&e.jsx(ue,{onClose:()=>x(!1)})]})},bt=()=>e.jsxs("div",{className:"relative flex items-center justify-between rounded-xl bg-gradient-to-r from-grey-800 to-grey-700 p-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"size-5 text-primary shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-high font-medium",children:"Learn about delegated staking"}),e.jsx("span",{className:"text-mid ml-2",children:"Understand how staking works, rewards distribution, and withdrawal periods."})]})]}),e.jsxs("a",{href:"https://docs.ar.io/learn/token/staking/#how-delegated-staking-works",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-sm font-medium text-primary hover:text-high transition-colors shrink-0",children:["View Docs",e.jsx(Ze,{className:"size-3"})]})]}),St=()=>e.jsxs("div",{className:"flex flex-col gap-6 pb-6",children:[e.jsx(jt,{}),e.jsx(bt,{}),e.jsx(ke,{})]}),Lt=()=>{const r=A(x=>x.walletAddress);return e.jsxs("div",{className:"px-4 lg:px-6 flex h-full max-w-full flex-col",children:[e.jsx("div",{className:"mb-4 shrink-0",children:e.jsx(Ke,{})}),e.jsx("div",{className:"flex-1 overflow-scroll scrollbar scrollbar-thin",children:r?e.jsx(vt,{}):e.jsx(St,{})})]})};export{Lt as default};
//# sourceMappingURL=index-BCrgzjQe.js.map
